<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>SendAHandyman ‚Äî Same-Day / Next-Day Handyman Dispatch</title>
    <meta name="description" content="Book a vetted handyman today or tomorrow. Upload photos, get an instant AI estimate, and reserve with your card. Serving Palm Beach, Broward & Miami-Dade." />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://js.stripe.com/v3/"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png">
    <style>
        body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji"}
        .shadow-soft{box-shadow:0 10px 30px rgba(0,0,0,.06)}

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        .pricing-option {
            transition: all 0.2s ease;
        }

        .pricing-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,.1);
        }

        .pricing-option.selected {
            border-color: #4f46e5;
            background-color: #f8fafc;
        }

        .pricing-badge {
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            background: #4f46e5;
            color: white;
            font-size: 0.75rem;
            padding: 2px 8px;
            border-radius: 12px;
            font-weight: 600;
        }

        .pricing-badge.premium {
            background: #dc2626;
        }

        .pricing-badge.discount {
            background: #059669;
        }

        .chatbot-typing {
            display: inline-block;
        }

        .chatbot-typing::after {
            content: '';
            animation: chatbot-dots 1.5s infinite;
        }

        @keyframes chatbot-dots {
            0%, 20% { content: ''; }
            40% { content: '.'; }
            60% { content: '..'; }
            80%, 100% { content: '...'; }
        }

        /* Enhanced Chatbot Styling */
        #chatbot-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }

        #chatbot-toggle {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            border: none;
            border-radius: 50%;
            width: 70px;
            height: 70px;
            box-shadow: 0 8px 25px rgba(79, 70, 229, 0.4);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        #chatbot-toggle:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(79, 70, 229, 0.6);
            background: linear-gradient(135deg, #3730a3 0%, #6d28d9 100%);
        }

        #chatbot-toggle:active {
            transform: translateY(-1px);
        }

        /* Pulsing animation for attention */
        #chatbot-toggle::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            animation: chatbot-pulse 2s infinite;
        }

        @keyframes chatbot-pulse {
            0% {
                transform: scale(1);
                opacity: 0.7;
            }
            50% {
                transform: scale(1.1);
                opacity: 0.3;
            }
            100% {
                transform: scale(1);
                opacity: 0.7;
            }
        }

        /* Icon styling */
        #chatbot-toggle svg {
            width: 32px;
            height: 32px;
            z-index: 2;
            position: relative;
        }

        /* Help text that appears on hover */
        #chatbot-toggle::after {
            content: 'Need help? Click to chat!';
            position: absolute;
            right: 85px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 14px;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            pointer-events: none;
        }

        #chatbot-toggle:hover::after {
            opacity: 1;
            visibility: visible;
            right: 80px;
        }

        /* Small notification badge */
        .chatbot-notification {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ef4444;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            animation: bounce 1s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-5px);
            }
            60% {
                transform: translateY(-3px);
            }
        }

        /* Chat window improvements */
        #chatbot-window {
            width: 380px;
            height: 500px;
            bottom: 100px;
            right: 0;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
        }

        /* Mobile hamburger menu */
        .mobile-menu-btn {
            display: none;
        }

        .mobile-menu {
            display: none;
        }

        /* Mobile responsiveness - ONLY ADDED TWO-ROW MOBILE HEADER STYLES */
        @media (max-width: 768px) {
            .mobile-menu-btn {
                display: block;
            }

            .desktop-nav {
                display: none;
            }

            .mobile-menu.active {
                display: block;
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                background: white;
                border-top: 1px solid #e2e8f0;
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
                z-index: 50;
            }

            .mobile-menu a {
                display: block;
                padding: 12px 16px;
                border-bottom: 1px solid #f1f5f9;
                color: #475569;
                text-decoration: none;
            }

            .mobile-menu a:hover {
                background: #f8fafc;
                color: #4f46e5;
            }

            /* Two-row mobile header spacing */
            .mobile-header-row-2 {
                margin-top: 0.5rem;
            }

            #chatbot-container {
                bottom: 15px;
                right: 15px;
            }

            #chatbot-toggle {
                width: 65px;
                height: 65px;
            }

            #chatbot-toggle svg {
                width: 28px;
                height: 28px;
            }

            #chatbot-toggle::after {
                display: none; /* Hide help text on mobile */
            }

            #chatbot-window {
                width: 95vw;
                height: 70vh;
                right: 2.5vw;
                bottom: 85px;
            }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">
<!-- Header - MODIFIED FOR TWO-ROW MOBILE LAYOUT -->
<header class="bg-white/80 backdrop-blur sticky top-0 z-40 border-b border-slate-100">
    <div class="max-w-6xl mx-auto px-4 py-3 relative">
        <!-- Desktop Layout -->
        <div class="hidden md:flex items-center justify-between">
            <a href="index.html" class="flex items-center gap-2 hover:opacity-80 transition-opacity">
                <img src="/images/helpinghands_logo.png" alt="Helping Hands Logo" class="h-9 w-auto">
                <span class="font-semibold">SendAHandyman</span>
            </a>

            <!-- Desktop Navigation -->
            <nav class="desktop-nav flex items-center gap-6 text-sm">
                <a href="#how" class="hover:text-indigo-600">How it works</a>
                <a href="#book" class="hover:text-indigo-600">Book now</a>
                <a href="concierge.html" class="hover:text-indigo-600">Concierge</a>
                <a href="#coverage" class="hover:text-indigo-600">Coverage</a>
                <a href="#faq" class="hover:text-indigo-600">FAQ</a>
            </nav>

            <a href="#book" class="inline-flex items-center gap-2 rounded-xl bg-indigo-600 px-4 py-2 text-white text-sm font-semibold shadow-soft">Book same-day</a>
        </div>

        <!-- Mobile Layout - Two Rows -->
        <div class="md:hidden">
            <!-- Row 1: Logo + Hamburger -->
            <div class="flex items-center justify-between">
                <a href="index.html" class="flex items-center gap-2 hover:opacity-80 transition-opacity">
                    <img src="/images/helpinghands_logo.png" alt="Helping Hands Logo" class="h-9 w-auto">
                    <span class="font-semibold">SendAHandyman</span>
                </a>

                <!-- Mobile Menu Button -->
                <button class="mobile-menu-btn p-2" id="mobile-menu-btn">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
            </div>

            <!-- Row 2: Book Button -->
            <div class="mobile-header-row-2 flex justify-center">
                <a href="#book" class="inline-flex items-center gap-2 rounded-xl bg-indigo-600 px-4 py-2 text-white text-sm font-semibold shadow-soft">Book same-day</a>
            </div>
        </div>

        <!-- Mobile Menu -->
        <div class="mobile-menu" id="mobile-menu">
            <a href="#how">How it works</a>
            <a href="#book">Book now</a>
            <a href="concierge.html">Concierge</a>
            <a href="#coverage">Coverage</a>
            <a href="#faq">FAQ</a>
        </div>
    </div>
</header>

<!-- Hero -->
<section class="bg-gradient-to-b from-white to-slate-50">
    <div class="max-w-6xl mx-auto px-4 py-10 md:py-16 grid md:grid-cols-2 gap-10 items-center">
        <div>
            <h1 class="text-3xl md:text-5xl font-extrabold leading-tight">Local handyman help ‚Äî <span class="text-indigo-600">today or tomorrow</span>.</h1>
            <p class="mt-3 text-xl font-medium text-slate-800">Skip the contractor shopping. Just pick your task and we dispatch the right pro.</p>
            <p class="mt-4 text-slate-600 text-lg">Upload photos, get an instant AI estimate, and reserve with your card. We dispatch a vetted pro and text you updates. Serving Palm Beach, Broward & Miami-Dade.</p>
            <ul class="mt-6 space-y-2 text-slate-700">
                <li>‚úÖ Vetted & background-checked pros</li>
                <li>‚úÖ Fixed pricing + transparent same-day premium</li>
                <li>‚úÖ Same-day / next-day time windows</li>
            </ul>
            <div class="mt-6 flex gap-3">
                <a href="#book" class="rounded-xl bg-indigo-600 px-5 py-3 text-white font-semibold shadow-soft">Start your request</a>
                <a href="#how" class="rounded-xl bg-white px-5 py-3 font-semibold border border-slate-200">How it works</a>
            </div>
        </div>
        <div class="bg-white rounded-2xl p-5 shadow-soft border border-slate-100">
            <div class="aspect-video rounded-xl bg-[url('/images/Ceiling_Fan_Installation.png')] bg-cover bg-center"></div>
        </div>
    </div>
</section>

<!-- Task Selection -->
<section class="py-10 border-t border-slate-100 bg-white" id="tasks">
    <div class="max-w-6xl mx-auto px-4">
        <h2 class="text-2xl md:text-3xl font-bold">Popular fixed-price tasks</h2>
        <p class="text-slate-600 mt-2">Click any service to see what's included, then proceed to booking.</p>

        <div class="mt-6 space-y-4">
            <!-- TV Mount Service -->
            <div class="service-card bg-white border border-slate-200 rounded-xl overflow-hidden cursor-pointer hover:border-indigo-300 transition-colors" data-task="tv_mount">
                <div class="service-header p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold text-lg">üì∫ TV Wall Mount (32‚Äì65")</h3>
                            <p class="text-sm text-slate-600">~1.5 hr base ‚Ä¢ Starting at $120</p>
                        </div>
                        <div class="expand-icon text-slate-400 transform transition-transform">‚ñº</div>
                    </div>
                </div>
                <div class="service-details hidden border-t border-slate-100">
                    <div class="p-4">
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-semibold text-green-600 mb-2">‚úÖ Included:</h4>
                                <ul class="text-sm space-y-1 text-slate-700">
                                    <li>‚Ä¢ Mounting TV (32‚Äì65") on drywall with wood studs</li>
                                    <li>‚Ä¢ Using customer-supplied mount</li>
                                    <li>‚Ä¢ Cord cover (if provided)</li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="font-semibold text-orange-600 mb-2">‚ö†Ô∏è Potential Add-ons:</h4>
                                <ul class="text-sm space-y-1 text-slate-700">
                                    <li>‚Ä¢ +$40: Mounting on brick, concrete, or over fireplace</li>
                                    <li>‚Ä¢ +$25: TVs larger than 65"</li>
                                    <li>‚Ä¢ New outlet/electrical work not included</li>
                                </ul>
                            </div>
                        </div>
                        <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                            <p class="text-sm text-blue-700">Click to select this service and answer specific questions in the booking form.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ceiling Fan Service -->
            <div class="service-card bg-white border border-slate-200 rounded-xl overflow-hidden cursor-pointer hover:border-indigo-300 transition-colors" data-task="ceiling_fan">
                <div class="service-header p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold text-lg">üí° Ceiling Fan Install/Replace</h3>
                            <p class="text-sm text-slate-600">~2.0 hr base ‚Ä¢ Starting at $160</p>
                        </div>
                        <div class="expand-icon text-slate-400 transform transition-transform">‚ñº</div>
                    </div>
                </div>
                <div class="service-details hidden border-t border-slate-100">
                    <div class="p-4">
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-semibold text-green-600 mb-2">‚úÖ Included:</h4>
                                <ul class="text-sm space-y-1 text-slate-700">
                                    <li>‚Ä¢ Replacing existing fan or light fixture</li>
                                    <li>‚Ä¢ Using existing wiring and fan-rated box</li>
                                    <li>‚Ä¢ Assembling blades/light kit</li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="font-semibold text-orange-600 mb-2">‚ö†Ô∏è Potential Add-ons:</h4>
                                <ul class="text-sm space-y-1 text-slate-700">
                                    <li>‚Ä¢ +$50: No fan-rated box (requires replacement)</li>
                                    <li>‚Ä¢ +$40: Ceilings higher than 10 ft</li>
                                    <li>‚Ä¢ New wiring or switches not included</li>
                                </ul>
                            </div>
                        </div>
                        <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                            <p class="text-sm text-blue-700">Click to select this service and answer specific questions in the booking form.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Light Fixture Service -->
            <div class="service-card bg-white border border-slate-200 rounded-xl overflow-hidden cursor-pointer hover:border-indigo-300 transition-colors" data-task="light_fixture">
                <div class="service-header p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold text-lg">‚ú® Light Fixture / Chandelier Swap</h3>
                            <p class="text-sm text-slate-600">~1.0 hr base ‚Ä¢ Starting at $80</p>
                        </div>
                        <div class="expand-icon text-slate-400 transform transition-transform">‚ñº</div>
                    </div>
                </div>
                <div class="service-details hidden border-t border-slate-100">
                    <div class="p-4">
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-semibold text-green-600 mb-2">‚úÖ Included:</h4>
                                <ul class="text-sm space-y-1 text-slate-700">
                                    <li>‚Ä¢ Remove old fixture, install new</li>
                                    <li>‚Ä¢ Connect to existing wiring</li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="font-semibold text-orange-600 mb-2">‚ö†Ô∏è Potential Add-ons:</h4>
                                <ul class="text-sm space-y-1 text-slate-700">
                                    <li>‚Ä¢ +$40: Chandeliers over 25 lbs</li>
                                    <li>‚Ä¢ +$30: Ceiling over 10 ft</li>
                                    <li>‚Ä¢ Structural bracing or rewiring not included</li>
                                </ul>
                            </div>
                        </div>
                        <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                            <p class="text-sm text-blue-700">Click to select this service and answer specific questions in the booking form.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Faucet/Showerhead Service -->
            <div class="service-card bg-white border border-slate-200 rounded-xl overflow-hidden cursor-pointer hover:border-indigo-300 transition-colors" data-task="faucet_showerhead">
                <div class="service-header p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold text-lg">üö∞ Faucet / Showerhead Replace</h3>
                            <p class="text-sm text-slate-600">~1.0 hr base ‚Ä¢ Starting at $80</p>
                        </div>
                        <div class="expand-icon text-slate-400 transform transition-transform">‚ñº</div>
                    </div>
                </div>
                <div class="service-details hidden border-t border-slate-100">
                    <div class="p-4">
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-semibold text-green-600 mb-2">‚úÖ Included:</h4>
                                <ul class="text-sm space-y-1 text-slate-700">
                                    <li>‚Ä¢ Remove old fixture and install new</li>
                                    <li>‚Ä¢ Connect to existing plumbing</li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="font-semibold text-orange-600 mb-2">‚ö†Ô∏è Potential Add-ons:</h4>
                                <ul class="text-sm space-y-1 text-slate-700">
                                    <li>‚Ä¢ +$40: Corroded plumbing requiring extra work</li>
                                    <li>‚Ä¢ +$30: Removing sink/vanity for access</li>
                                    <li>‚Ä¢ Leak repairs not included</li>
                                </ul>
                            </div>
                        </div>
                        <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                            <p class="text-sm text-blue-700">Click to select this service and answer specific questions in the booking form.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Smart Doorbell Service -->
            <div class="service-card bg-white border border-slate-200 rounded-xl overflow-hidden cursor-pointer hover:border-indigo-300 transition-colors" data-task="smart_doorbell">
                <div class="service-header p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold text-lg">üîî Smart Doorbell Install</h3>
                            <p class="text-sm text-slate-600">~0.75 hr base ‚Ä¢ Starting at $60</p>
                        </div>
                        <div class="expand-icon text-slate-400 transform transition-transform">‚ñº</div>
                    </div>
                </div>
                <div class="service-details hidden border-t border-slate-100">
                    <div class="p-4">
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-semibold text-green-600 mb-2">‚úÖ Included:</h4>
                                <ul class="text-sm space-y-1 text-slate-700">
                                    <li>‚Ä¢ Replace old doorbell or install wireless unit</li>
                                    <li>‚Ä¢ Connect to existing wiring or Wi-Fi</li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="font-semibold text-orange-600 mb-2">‚ö†Ô∏è Potential Add-ons:</h4>
                                <ul class="text-sm space-y-1 text-slate-700">
                                    <li>‚Ä¢ +$30: No wiring, drilling required</li>
                                    <li>‚Ä¢ +$40: Chime module/transformer replacement</li>
                                    <li>‚Ä¢ Complex rewiring not included</li>
                                </ul>
                            </div>
                        </div>
                        <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                            <p class="text-sm text-blue-700">Click to select this service and answer specific questions in the booking form.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Curtains/Blinds Service -->
            <div class="service-card bg-white border border-slate-200 rounded-xl overflow-hidden cursor-pointer hover:border-indigo-300 transition-colors" data-task="curtains_blinds">
                <div class="service-header p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold text-lg">ü™ü Curtain Rods / Blinds</h3>
                            <p class="text-sm text-slate-600">~1.0 hr base ‚Ä¢ Starting at $80</p>
                        </div>
                        <div class="expand-icon text-slate-400 transform transition-transform">‚ñº</div>
                    </div>
                </div>
                <div class="service-details hidden border-t border-slate-100">
                    <div class="p-4">
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-semibold text-green-600 mb-2">‚úÖ Included:</h4>
                                <ul class="text-sm space-y-1 text-slate-700">
                                    <li>‚Ä¢ Install up to 2 rods OR 2 blinds</li>
                                    <li>‚Ä¢ Mount to drywall with anchors</li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="font-semibold text-orange-600 mb-2">‚ö†Ô∏è Potential Add-ons:</h4>
                                <ul class="text-sm space-y-1 text-slate-700">
                                    <li>‚Ä¢ +$20: Each extra rod/blind beyond 2</li>
                                    <li>‚Ä¢ +$40: Mounting on brick, tile, or concrete</li>
                                    <li>‚Ä¢ Custom carpentry not included</li>
                                </ul>
                            </div>
                        </div>
                        <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                            <p class="text-sm text-blue-700">Click to select this service and answer specific questions in the booking form.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Floating Shelf Service -->
            <div class="service-card bg-white border border-slate-200 rounded-xl overflow-hidden cursor-pointer hover:border-indigo-300 transition-colors" data-task="floating_shelf">
                <div class="service-header p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold text-lg">üìö Floating Shelf Install</h3>
                            <p class="text-sm text-slate-600">~1.0 hr base ‚Ä¢ Starting at $80</p>
                        </div>
                        <div class="expand-icon text-slate-400 transform transition-transform">‚ñº</div>
                    </div>
                </div>
                <div class="service-details hidden border-t border-slate-100">
                    <div class="p-4">
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-semibold text-green-600 mb-2">‚úÖ Included:</h4>
                                <ul class="text-sm space-y-1 text-slate-700">
                                    <li>‚Ä¢ Install up to 2 shelves</li>
                                    <li>‚Ä¢ Standard drywall mounting with anchors</li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="font-semibold text-orange-600 mb-2">‚ö†Ô∏è Potential Add-ons:</h4>
                                <ul class="text-sm space-y-1 text-slate-700">
                                    <li>‚Ä¢ +$20: Each extra shelf beyond 2</li>
                                    <li>‚Ä¢ +$30: Shelves over 25 lbs or heavy-duty models</li>
                                    <li>‚Ä¢ Masonry/tile installs not included</li>
                                </ul>
                            </div>
                        </div>
                        <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                            <p class="text-sm text-blue-700">Click to select this service and answer specific questions in the booking form.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Appliance Hookup Service -->
            <div class="service-card bg-white border border-slate-200 rounded-xl overflow-hidden cursor-pointer hover:border-indigo-300 transition-colors" data-task="appliance_hookup">
                <div class="service-header p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold text-lg">‚ö° Appliance Hookup (W/D/DW)</h3>
                            <p class="text-sm text-slate-600">~1.5 hr base ‚Ä¢ Starting at $120</p>
                        </div>
                        <div class="expand-icon text-slate-400 transform transition-transform">‚ñº</div>
                    </div>
                </div>
                <div class="service-details hidden border-t border-slate-100">
                    <div class="p-4">
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-semibold text-green-600 mb-2">‚úÖ Included:</h4>
                                <ul class="text-sm space-y-1 text-slate-700">
                                    <li>‚Ä¢ Connect new appliance to existing hookups</li>
                                    <li>‚Ä¢ Level and test basic function</li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="font-semibold text-orange-600 mb-2">‚ö†Ô∏è Potential Add-ons:</h4>
                                <ul class="text-sm space-y-1 text-slate-700">
                                    <li>‚Ä¢ +$40: Old appliance removal/disposal</li>
                                    <li>‚Ä¢ +$30: New vent or supply line required</li>
                                    <li>‚Ä¢ Plumbing/electrical modifications not included</li>
                                </ul>
                            </div>
                        </div>
                        <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                            <p class="text-sm text-blue-700">Click to select this service and answer specific questions in the booking form.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Furniture Assembly Service -->
            <div class="service-card bg-white border border-slate-200 rounded-xl overflow-hidden cursor-pointer hover:border-indigo-300 transition-colors" data-task="furniture_assembly">
                <div class="service-header p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold text-lg">ü™ë Furniture Assembly (S‚ÄìM)</h3>
                            <p class="text-sm text-slate-600">~1.5 hr base ‚Ä¢ Starting at $120</p>
                        </div>
                        <div class="expand-icon text-slate-400 transform transition-transform">‚ñº</div>
                    </div>
                </div>
                <div class="service-details hidden border-t border-slate-100">
                    <div class="p-4">
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-semibold text-green-600 mb-2">‚úÖ Included:</h4>
                                <ul class="text-sm space-y-1 text-slate-700">
                                    <li>‚Ä¢ Assembly of 1 major item or 2‚Äì3 small items</li>
                                    <li>‚Ä¢ Standard flat-pack furniture</li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="font-semibold text-orange-600 mb-2">‚ö†Ô∏è Potential Add-ons:</h4>
                                <ul class="text-sm space-y-1 text-slate-700">
                                    <li>‚Ä¢ +$30: Large/complex pieces (beds, wardrobes, sectionals)</li>
                                    <li>‚Ä¢ +$20 per extra small item</li>
                                    <li>‚Ä¢ Wall anchoring not included unless specified</li>
                                </ul>
                            </div>
                        </div>
                        <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                            <p class="text-sm text-blue-700">Click to select this service and answer specific questions in the booking form.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Closet Organizer Service -->
            <div class="service-card bg-white border border-slate-200 rounded-xl overflow-hidden cursor-pointer hover:border-indigo-300 transition-colors" data-task="closet_organizer">
                <div class="service-header p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold text-lg">üëï Closet Organizer Install</h3>
                            <p class="text-sm text-slate-600">~2.0 hr base ‚Ä¢ Starting at $160</p>
                        </div>
                        <div class="expand-icon text-slate-400 transform transition-transform">‚ñº</div>
                    </div>
                </div>
                <div class="service-details hidden border-t border-slate-100">
                    <div class="p-4">
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-semibold text-green-600 mb-2">‚úÖ Included:</h4>
                                <ul class="text-sm space-y-1 text-slate-700">
                                    <li>‚Ä¢ Install standard closet kit (customer-supplied)</li>
                                    <li>‚Ä¢ Mount to drywall with included hardware</li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="font-semibold text-orange-600 mb-2">‚ö†Ô∏è Potential Add-ons:</h4>
                                <ul class="text-sm space-y-1 text-slate-700">
                                    <li>‚Ä¢ +$50: Cutting/custom fitting required</li>
                                    <li>‚Ä¢ +$40: Masonry or non-standard walls</li>
                                    <li>‚Ä¢ Electrical/lighting not included</li>
                                </ul>
                            </div>
                        </div>
                        <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                            <p class="text-sm text-blue-700">Click to select this service and answer specific questions in the booking form.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- General Handyman Service -->
            <div class="service-card bg-white border border-slate-200 rounded-xl overflow-hidden cursor-pointer hover:border-indigo-300 transition-colors" data-task="general_handyman">
                <div class="service-header p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold text-lg">üîß General Handyman (2+ hours)</h3>
                            <p class="text-sm text-slate-600">~2.0 hr minimum ‚Ä¢ Starting at $160</p>
                        </div>
                        <div class="expand-icon text-slate-400 transform transition-transform">‚ñº</div>
                    </div>
                </div>
                <div class="service-details hidden border-t border-slate-100">
                    <div class="p-4">
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-semibold text-green-600 mb-2">‚úÖ Included:</h4>
                                <ul class="text-sm space-y-1 text-slate-700">
                                    <li>‚Ä¢ 2-hour minimum for general repairs & tasks</li>
                                    <li>‚Ä¢ Basic tools and hardware</li>
                                    <li>‚Ä¢ Multiple small tasks or one larger project</li>
                                    <li>‚Ä¢ Troubleshooting and problem-solving</li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="font-semibold text-orange-600 mb-2">‚ö†Ô∏è Add-on Options:</h4>
                                <ul class="text-sm space-y-1 text-slate-700">
                                    <li>‚Ä¢ +$180: Additional 3-hour block (discounted rate)</li>
                                    <li>‚Ä¢ +$360: Two additional 3-hour blocks (6 hours total)</li>
                                    <li>‚Ä¢ Materials and parts charged separately</li>
                                    <li>‚Ä¢ Specialized trades (plumbing/electrical) not included</li>
                                </ul>
                            </div>
                        </div>
                        <div class="mt-4 p-3 bg-amber-50 border border-amber-200 rounded-lg">
                            <p class="text-sm text-amber-700"><strong>Perfect for:</strong> Touch-up painting, caulking, door adjustments, squeaky hinges, loose handles, weatherstripping, minor drywall repairs, picture hanging, shelf brackets, cabinet adjustments, and other miscellaneous tasks.</p>
                        </div>
                        <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                            <p class="text-sm text-blue-700">Click to select this service and specify your tasks in the booking form.</p>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <!-- Standard Policy Note -->
        <div class="mt-8 bg-slate-50 border border-slate-200 rounded-xl p-6">
            <h3 class="font-semibold text-lg mb-3">üîë Standard Policy for All Tasks</h3>
            <div class="grid md:grid-cols-2 gap-4 text-sm text-slate-700">
                <ul class="space-y-2">
                    <li>‚Ä¢ Flat-rate pricing covers base scope</li>
                    <li>‚Ä¢ Add-ons are always quoted and approved before work begins</li>
                </ul>
                <ul class="space-y-2">
                    <li>‚Ä¢ Cancel anytime before work starts ‚Äî no charge</li>
                    <li>‚Ä¢ Customer must supply fixtures, furniture, appliances, and hardware</li>
                </ul>
            </div>
        </div>
    </div>
</section>

<!-- How it works -->
<section id="how" class="py-12">
    <div class="max-w-6xl mx-auto px-4">
        <h2 class="text-2xl md:text-3xl font-bold">How it works</h2>
        <div class="mt-6 grid md:grid-cols-4 gap-6">
            <div class="bg-white rounded-xl p-5 shadow-soft border border-slate-100"><div class="font-semibold">1) Tell us what you need</div><p class="text-sm text-slate-600 mt-1">Pick a task, add notes, and upload 2‚Äì5 photos.</p></div>
            <div class="bg-white rounded-xl p-5 shadow-soft border border-slate-100"><div class="font-semibold">2) Instant AI estimate</div><p class="text-sm text-slate-600 mt-1">We analyze your photos to estimate time, parts, and price.</p></div>
            <div class="bg-white rounded-xl p-5 shadow-soft border border-slate-100"><div class="font-semibold">3) Reserve with card</div><p class="text-sm text-slate-600 mt-1">Same-day & evening premiums shown upfront.</p></div>
            <div class="bg-white rounded-xl p-5 shadow-soft border border-slate-100"><div class="font-semibold">4) We dispatch a pro</div><p class="text-sm text-slate-600 mt-1">Nearest qualified tech with AI job sheet.</p></div>
        </div>
    </div>
</section>

<!-- STEP 2: Start Your Request Form -->
<section id="book" class="py-12">
    <div class="max-w-6xl mx-auto px-4 grid md:grid-cols-2 gap-10 items-start">
        <div class="bg-white rounded-2xl p-6 shadow-soft border border-slate-100">
            <h3 class="text-xl font-bold">Start your request</h3>
            <p class="text-sm text-slate-600 mt-1">We'll analyze your photos and show pricing options before you pay.</p>

            <div class="mt-4 grid md:grid-cols-2 gap-4">
                <div><label class="text-sm font-semibold">Full name</label><input id="customerName" required class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2" /></div>
                <div><label class="text-sm font-semibold">Mobile phone</label><input id="customerPhone" required class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2" /></div>
                <div><label class="text-sm font-semibold">Email</label><input type="email" id="customerEmail" required class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2" /></div>
                <div><label class="text-sm font-semibold">ZIP code</label><input id="customerZip" required class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2" /></div>
            </div>

            <div class="mt-4"><label class="text-sm font-semibold">Address (optional)</label><input id="customerAddress" class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2" /></div>

            <div class="mt-4 grid md:grid-cols-2 gap-4">
                <div>
                    <label class="text-sm font-semibold">Task</label>
                    <select id="taskCategory" required class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2">
                        <option value="">Select a task‚Ä¶</option>
                        <option value="tv_mount">TV mounting</option>
                        <option value="ceiling_fan">Ceiling fan install</option>
                        <option value="light_fixture">Light fixture / chandelier swap</option>
                        <option value="faucet_showerhead">Faucet / showerhead replace</option>
                        <option value="smart_doorbell">Smart doorbell install</option>
                        <option value="curtains_blinds">Curtain rods / blinds</option>
                        <option value="floating_shelf">Floating shelf install</option>
                        <option value="appliance_hookup">Appliance hookup (W/D/DW)</option>
                        <option value="furniture_assembly">Furniture assembly (small‚Äìmedium)</option>
                        <option value="closet_organizer">Closet organizer install</option>
                        <option value="general_handyman">General handyman (2+ hours)</option>
                        <option value="minor_repairs">Minor repairs</option>
                    </select>
                </div>
                <div>
                    <label class="text-sm font-semibold">Preferred timing</label>
                    <select id="taskWindow" required class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2">
                        <option value="today_am">Today (8‚Äì12)</option>
                        <option value="today_pm">Today (12‚Äì4)</option>
                        <option value="today_eve">Today (4‚Äì8)</option>
                        <option value="tomorrow_am">Tomorrow (8‚Äì12)</option>
                        <option value="tomorrow_pm">Tomorrow (12‚Äì4)</option>
                    </select>
                </div>
            </div>

            <!-- Dynamic Task-Specific Questions -->
            <div id="taskQuestions" class="mt-4 hidden">
                <div class="p-4 bg-blue-50 border border-blue-200 rounded-lg">
                    <h4 class="font-semibold text-blue-800 mb-3">üìã Quick questions about your specific task</h4>
                    <div id="questionsContainer" class="space-y-3"></div>
                </div>
            </div>

            <div class="mt-4">
                <label class="text-sm font-semibold">Describe the job</label>
                <textarea id="taskDescription" rows="3" placeholder="Product link/model, wall/ceiling type, special notes‚Ä¶" class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2"></textarea>
            </div>

            <div class="mt-4">
                <label class="text-sm font-semibold">Upload photos (2‚Äì5)</label>
                <input id="taskPhotos" type="file" accept="image/*" multiple class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2" />
                <div id="photoThumbs" class="mt-2 flex flex-wrap gap-2"></div>
            </div>

            <div class="mt-6 flex items-center gap-2">
                <input id="rushOption" type="checkbox" class="h-4 w-4" />
                <label for="rushOption" class="text-sm">Optional rush (+10%)</label>
            </div>

            <!-- Disclaimer about add-ons -->
            <div class="mt-4 p-3 bg-amber-50 border border-amber-200 rounded-lg">
                <p class="text-sm text-amber-800">
                    <strong>‚ö†Ô∏è Important:</strong> The final price may include additional charges if site conditions differ from what's described above (e.g., non-standard materials, unexpected complications, etc.). Your technician will always get approval before performing any add-on work.
                </p>
            </div>

            <!-- STEP 3: Get Instant Estimate Button with Progress -->
            <div class="mt-6">
                <button type="button" id="getEstimateBtn" class="relative w-full overflow-hidden rounded-xl bg-slate-900 text-white px-5 py-3 font-semibold transition-all disabled:opacity-75">
                    <div id="progressBg" class="absolute inset-0 bg-gradient-to-r from-indigo-600 to-purple-600 transform -translate-x-full transition-transform duration-3000 ease-out"></div>
                    <span id="estimateText" class="relative z-10">üîß Get pricing options</span>
                </button>

                <!-- Progress Bar Below Button -->
                <div id="progressContainer" class="mt-3 hidden">
                    <div class="w-full bg-slate-200 rounded-full h-2">
                        <div id="progressBar" class="bg-gradient-to-r from-blue-500 to-indigo-600 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                    </div>
                    <div id="progressMessage" class="text-sm text-slate-600 mt-1 text-center">Starting analysis...</div>
                </div>
            </div>
        </div>

        <!-- AI Estimate Panel (Shows after Step 3 completes) -->
        <aside id="estimatePanel" class="bg-white rounded-2xl p-6 shadow-soft border border-slate-100 hidden">
            <h3 class="text-xl font-bold">Choose your timing & price</h3>
            <p class="text-sm text-slate-600 mb-6">Select your preferred option. All prices include everything.</p>

            <!-- Pricing Options Container -->
            <div id="pricingOptions" class="space-y-4 mb-6">
                <!-- Options will be dynamically inserted here -->
            </div>

            <div class="mt-4">
                <h4 class="font-semibold">What we'll do</h4>
                <ul id="estimateScope" class="list-disc pl-5 text-sm text-slate-700 space-y-1"></ul>
            </div>
            <div class="mt-4">
                <h4 class="font-semibold">Things to note</h4>
                <ul id="estimateRisks" class="list-disc pl-5 text-sm text-slate-700 space-y-1"></ul>
            </div>
            <div class="mt-6">
                <button id="reserveBtn" class="w-full rounded-xl bg-indigo-600 text-white px-5 py-3 font-semibold shadow-soft disabled:opacity-50" disabled>üí≥ Reserve with card</button>
            </div>
            <p class="mt-3 text-xs text-slate-500">If site conditions differ, your tech will confirm any changes before work begins.</p>
        </aside>
    </div>
</section>

<!-- STEP 4: Payment Modal -->
<div id="paymentModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl p-6 max-w-md w-full shadow-2xl max-h-[90vh] overflow-y-auto">
        <div class="flex items-center justify-between mb-4">
            <h3 class="text-xl font-bold">Complete Payment</h3>
            <button id="closePayment" class="text-slate-400 hover:text-slate-600 text-2xl">&times;</button>
        </div>

        <div class="mb-4 p-3 bg-slate-50 rounded-lg">
            <div class="text-sm text-slate-600">Total amount</div>
            <div id="paymentAmount" class="text-2xl font-bold">$0</div>
            <div class="text-sm text-slate-600 mt-1">
                <span id="paymentTiming">Selected timing</span>
            </div>
        </div>

        <form id="paymentForm">
            <div id="stripe-payment-element" class="mb-4"></div>

            <button id="submitPayment" type="submit" class="w-full rounded-xl bg-indigo-600 text-white px-5 py-3 font-semibold disabled:opacity-50 transition-all">
                <span id="paymentButtonText">Complete Payment</span>
            </button>

            <div id="paymentMessage" class="mt-4 text-sm hidden"></div>
        </form>
    </div>
</div>

<!-- STEP 5: Task Information Modal (Shows after payment approved) -->
<div id="taskInfoModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl p-6 max-w-lg w-full shadow-2xl max-h-[90vh] overflow-y-auto">
        <div class="text-center mb-6">
            <div class="text-6xl mb-2">‚úÖ</div>
            <h3 class="text-xl font-bold mb-2 text-green-600">Payment Approved!</h3>
            <div class="bg-green-50 border border-green-200 rounded-lg p-3 mb-4">
                <p class="text-sm text-green-700">Your payment was processed successfully. Please provide additional details below to dispatch your handyman.</p>
            </div>
        </div>

        <form id="taskInfoForm">
            <!-- Pre-populated fields from Step 2 -->
            <div class="bg-slate-50 rounded-lg p-4 mb-6">
                <h4 class="font-semibold mb-3">Job Summary (from your request)</h4>
                <div class="text-sm space-y-1">
                    <div><strong>Task ID:</strong> <span id="summaryTaskId" class="font-mono text-indigo-600">‚Äî</span></div>
                    <div><strong>Customer:</strong> <span id="summaryName">‚Äî</span></div>
                    <div><strong>Phone:</strong> <span id="summaryPhone">‚Äî</span></div>
                    <div><strong>Email:</strong> <span id="summaryEmail">‚Äî</span></div>
                    <div><strong>Task:</strong> <span id="summaryTask">‚Äî</span></div>
                    <div><strong>Window:</strong> <span id="summaryWindow">‚Äî</span></div>
                    <div><strong>Description:</strong> <span id="summaryDescription">‚Äî</span></div>
                </div>
            </div>

            <div class="space-y-4">
                <div>
                    <label class="text-sm font-semibold text-gray-700">Complete Property Address *</label>
                    <textarea id="propertyAddress" rows="3" placeholder="123 Main St, Unit 2B, Boca Raton, FL 33432" required class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2 focus:ring-2 focus:ring-indigo-500"></textarea>
                </div>

                <div>
                    <label class="text-sm font-semibold text-gray-700">Best Contact Phone *</label>
                    <input type="tel" id="contactPhone" required class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2 focus:ring-2 focus:ring-indigo-500" />
                </div>

                <div>
                    <label class="text-sm font-semibold text-gray-700">Property Access Details</label>
                    <textarea id="accessDetails" rows="3" placeholder="Gate code: 1234, Park in visitor spots, Ring doorbell..." class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2 focus:ring-2 focus:ring-indigo-500"></textarea>
                </div>

                <div>
                    <label class="text-sm font-semibold text-gray-700">Pets & Special Considerations</label>
                    <textarea id="petsAndSpecial" rows="2" placeholder="2 friendly dogs, alarm system code needed, delicate antiques nearby..." class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2 focus:ring-2 focus:ring-indigo-500"></textarea>
                </div>

                <div>
                    <label class="text-sm font-semibold text-gray-700">Additional Task Details</label>
                    <textarea id="additionalDetails" rows="3" placeholder="TV model: Samsung 65", wall type: drywall, tools available on site..." class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2 focus:ring-2 focus:ring-indigo-500"></textarea>
                </div>
            </div>

            <div class="mt-6">
                <button type="submit" class="w-full rounded-xl bg-indigo-600 text-white px-5 py-3 font-semibold hover:bg-indigo-700 transition-colors">
                    üöÄ Dispatch Handyman
                </button>
            </div>
        </form>
    </div>
</div>

<!-- STEP 6: Final Success Modal -->
<div id="finalSuccessModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl p-6 max-w-md w-full shadow-2xl text-center">
        <div class="text-6xl mb-4">üöÄ</div>
        <h3 class="text-xl font-bold mb-2 text-green-600">Handyman Dispatched!</h3>
        <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-4">
            <p class="text-sm text-green-700 mb-2">
                <strong>‚úÖ Payment processed</strong><br>
                <strong>‚úÖ Job details sent to our team</strong><br>
                <strong>‚úÖ Notification sent to handyman dispatch</strong>
            </p>
            <div class="mt-3 p-2 bg-white rounded border">
                <div class="text-xs text-slate-500">Your Task ID</div>
                <div id="finalTaskId" class="font-mono text-sm font-semibold text-indigo-600">‚Äî</div>
            </div>
            <p class="text-sm text-slate-600 mt-2">
                You'll receive a text message with your technician's details and estimated arrival time within the next 15 minutes.
            </p>
        </div>
        <button id="closeFinalSuccess" class="rounded-xl bg-indigo-600 text-white px-5 py-3 font-semibold hover:bg-indigo-700 transition-colors">Perfect!</button>
    </div>
</div>

<!-- Coverage -->
<section id="coverage" class="py-12 bg-white border-t border-b border-slate-100">
    <div class="max-w-6xl mx-auto px-4">
        <h2 class="text-2xl md:text-3xl font-bold">Coverage areas</h2>
        <p class="mt-2 text-slate-600">Palm Beach ‚Ä¢ Boca Raton ‚Ä¢ Delray Beach ‚Ä¢ Boynton Beach ‚Ä¢ Fort Lauderdale ‚Ä¢ Hollywood ‚Ä¢ Aventura ‚Ä¢ Miami ‚Ä¢ Coral Gables ‚Ä¢ Kendall</p>
    </div>
</section>

<!-- FAQ -->
<section id="faq" class="py-12">
    <div class="max-w-6xl mx-auto px-4 grid md:grid-cols-2 gap-8">
        <div><h3 class="text-xl font-bold">Is this a marketplace?</h3><p class="text-slate-600 mt-1">We're a vetted dispatch service. We send a qualified pro and back the work with standardized checklists and guidance.</p></div>
        <div><h3 class="text-xl font-bold">How do premiums work?</h3><p class="text-slate-600 mt-1">Like airline pricing, same-day and evening windows include a clear premium. It's shown before you pay.</p></div>
        <div><h3 class="text-xl font-bold">Do you charge before the job?</h3><p class="text-slate-600 mt-1">We place an authorization to secure your time. You're only charged after the tech confirms scope on site.</p></div>
        <div><h3 class="text-xl font-bold">Are pros background-checked?</h3><p class="text-slate-600 mt-1">Yes. We verify ID, experience, and insurance where applicable.</p></div>
    </div>
</section>

<!-- Enhanced Chatbot UI -->
<div id="chatbot-container" class="fixed bottom-4 right-4 z-50">
    <!-- Chat Button with notification badge -->
    <button id="chatbot-toggle" class="relative">
        <div class="chatbot-notification">!</div>
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
        </svg>
    </button>

    <!-- Chat Window -->
    <div id="chatbot-window" class="hidden absolute bottom-16 right-0 bg-white rounded-lg shadow-2xl border border-slate-200 flex flex-col">
        <!-- Chat Header -->
        <div class="bg-indigo-600 text-white p-4 rounded-t-lg flex items-center justify-between">
            <div>
                <h3 class="font-semibold">SendAHandyman Help</h3>
                <p class="text-sm text-indigo-100">Ask me about our services!</p>
            </div>
            <button id="chatbot-close" class="text-indigo-100 hover:text-white">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>

        <!-- Chat Messages -->
        <div id="chatbot-messages" class="flex-1 p-4 overflow-y-auto space-y-3">
            <div class="flex items-start space-x-2">
                <div class="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center flex-shrink-0">
                    <svg class="w-4 h-4 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                    </svg>
                </div>
                <div class="bg-slate-100 rounded-lg p-3 max-w-xs">
                    <p class="text-sm text-slate-700">Hi! I'm here to help with questions about our handyman services. What can I help you with today?</p>
                </div>
            </div>
        </div>

        <!-- Chat Input -->
        <div class="border-t border-slate-200 p-4">
            <div class="flex space-x-2">
                <input
                        type="text"
                        id="chatbot-input"
                        placeholder="Type your question..."
                        class="flex-1 border border-slate-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        maxlength="500"
                />
                <button
                        id="chatbot-send"
                        class="bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg px-4 py-2 text-sm font-semibold transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                >
                    Send
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Footer -->
<footer class="py-10 border-t border-slate-100 text-sm text-slate-600">
    <div class="max-w-6xl mx-auto px-4 flex flex-col md:flex-row items-center justify-between gap-3">
        <div class="flex items-center gap-2">
            <img src="/images/helpinghands_logo.png" alt="Helping Hands Logo" class="h-8 w-auto">
            <span>¬© <span id="year"></span> SendAHandyman v<span id="version"></span></span>
        </div>
        <div class="flex items-center gap-4">
            <a href="privacy.html" class="hover:text-slate-900">Privacy</a>
            <a href="terms.html" class="hover:text-slate-900">Terms</a>
            <a href="mailto:info@sendahandyman.com" class="hover:text-slate-900">Contact</a>
        </div>
    </div>
</footer>

<script>
    console.log('üìú JavaScript started loading...');

    // ZAPIER WEBHOOK CONFIGURATION - UPDATE THESE VALUES
    const ZAPIER_CONFIG = {
        WEBHOOK_URL: 'https://hooks.zapier.com/hooks/catch/24412806/uh8lvew/', // ‚ö†Ô∏è REPLACE with your actual Zapier webhook URL
        ENABLED: true // ‚ö†Ô∏è Change to true once you've set up your Zapier webhook
    };

    // GLOBAL STATE - Persisted in memory
    let formData = {};
    let estimateData = {};
    let selectedPricingOption = null;
    let paymentIntentId = null;
    let paymentElementReady = false; // Track payment element readiness

    // App version (update when package.json changes)
    const APP_VERSION = "1.0.0";

    // Stripe Configuration
    const STRIPE_PUBLISHABLE_KEY = 'pk_live_51Rz41zHQ4TkcNcqv0IXVWGjAjLo8EoSkGO2fbeINw6U23GsLSiaOsHYVSEPwlJbR2EZ515tqPDJcRPvDBYSdv2Wy00N7DPqhI3';
    let stripe, elements, paymentElement;

    const RATE = 80;
    const PREMIUM_SAMEDAY = 0.15;
    const PREMIUM_EVENING = 0.10;
    const PREMIUM_RUSH = 0.10;
    const PREMIUM_SOONER = 0.20;
    const DISCOUNT_LATER = 0.10;
    const DISCOUNT_FLEXIBLE = 0.15;


    // Function to determine if a time window is in the future
    function isTimeWindowAvailable(windowKey) {
    const now = new Date();
    const currentHour = now.getHours();

    if (windowKey.startsWith('today_')) {
        if (windowKey === 'today_am' && currentHour >= 12) return false;
        if (windowKey === 'today_pm' && currentHour >= 16) return false;
        if (windowKey === 'today_eve' && currentHour >= 20) return false;
    }

    return true; // Tomorrow slots are always available
    }

    // Function to get available time windows
    function getAvailableTimeWindows() {
        return Object.keys(TIME_WINDOWS).filter(isTimeWindowAvailable);
    }




    const TASKS = {
        tv_mount: {
            hours: 1.5,
            label: "TV Wall Mount (32‚Äì65\")",
            questions: [
                {
                    id: 'tv_size',
                    label: 'What size is your TV?',
                    options: [
                        { value: 'standard', label: '32-65 inches', addon: 0 },
                        { value: 'large', label: 'Larger than 65 inches', addon: 25 }
                    ]
                },
                {
                    id: 'wall_type',
                    label: 'What type of wall?',
                    options: [
                        { value: 'drywall', label: 'Drywall with studs', addon: 0 },
                        { value: 'brick', label: 'Brick/concrete', addon: 40 },
                        { value: 'fireplace', label: 'Above fireplace', addon: 40 }
                    ]
                },
                {
                    id: 'mount_owned',
                    label: 'Do you have the wall mount?',
                    options: [
                        { value: 'yes', label: 'Yes, I have it', addon: 0 },
                        { value: 'no', label: 'No, need to purchase', addon: 0 }
                    ]
                }
            ]
        },
        ceiling_fan: {
            hours: 2.0,
            label: "Ceiling Fan Install/Replace",
            questions: [
                {
                    id: 'replacing',
                    label: 'Replacing existing fan or light?',
                    options: [
                        { value: 'fan', label: 'Yes, existing fan', addon: 0 },
                        { value: 'light', label: 'Yes, existing light fixture', addon: 0 },
                        { value: 'new', label: 'New installation', addon: 0 }
                    ]
                },
                {
                    id: 'fan_box',
                    label: 'Is ceiling box fan-rated?',
                    options: [
                        { value: 'yes', label: 'Yes/Don\'t know', addon: 0 },
                        { value: 'no', label: 'No, needs replacement', addon: 50 }
                    ]
                },
                {
                    id: 'ceiling_height',
                    label: 'Ceiling height?',
                    options: [
                        { value: 'standard', label: 'Under 10 feet', addon: 0 },
                        { value: 'high', label: 'Over 10 feet', addon: 40 }
                    ]
                }
            ]
        },
        light_fixture: {
            hours: 1.0,
            label: "Light Fixture / Chandelier Swap",
            questions: [
                {
                    id: 'fixture_type',
                    label: 'Type of fixture?',
                    options: [
                        { value: 'standard', label: 'Standard light fixture', addon: 0 },
                        { value: 'small_chandelier', label: 'Chandelier (under 25 lbs)', addon: 0 },
                        { value: 'heavy_chandelier', label: 'Heavy chandelier (over 25 lbs)', addon: 40 }
                    ]
                },
                {
                    id: 'ceiling_height',
                    label: 'Ceiling height?',
                    options: [
                        { value: 'standard', label: 'Under 10 feet', addon: 0 },
                        { value: 'high', label: 'Over 10 feet', addon: 30 }
                    ]
                }
            ]
        },
        faucet_showerhead: {
            hours: 1.0,
            label: "Faucet / Showerhead Replace",
            questions: [
                {
                    id: 'fixture_type',
                    label: 'What are you replacing?',
                    options: [
                        { value: 'faucet', label: 'Kitchen/bathroom faucet', addon: 0 },
                        { value: 'showerhead', label: 'Showerhead', addon: 0 },
                        { value: 'both', label: 'Both faucet and showerhead', addon: 0 }
                    ]
                },
                {
                    id: 'plumbing_issues',
                    label: 'Any plumbing issues?',
                    options: [
                        { value: 'none', label: 'No issues', addon: 0 },
                        { value: 'corrosion', label: 'Some corrosion/leaks', addon: 40 },
                        { value: 'access', label: 'Need sink removal', addon: 30 }
                    ]
                }
            ]
        },
        smart_doorbell: {
            hours: 0.75,
            label: "Smart Doorbell Install",
            questions: [
                {
                    id: 'install_type',
                    label: 'Installation type?',
                    options: [
                        { value: 'replace', label: 'Replacing existing doorbell', addon: 0 },
                        { value: 'wireless', label: 'New wireless install', addon: 30 }
                    ]
                },
                {
                    id: 'chime_status',
                    label: 'Current doorbell chime working?',
                    options: [
                        { value: 'working', label: 'Yes, works fine', addon: 0 },
                        { value: 'broken', label: 'No/needs replacement', addon: 40 },
                        { value: 'no_chime', label: 'Don\'t want chime connected', addon: 0 }
                    ]
                }
            ]
        },
        curtains_blinds: {
            hours: 1.0,
            label: "Curtain Rods / Blinds",
            questions: [
                {
                    id: 'quantity',
                    label: 'How many rods/blinds?',
                    options: [
                        { value: 'standard', label: '1-2 items (included)', addon: 0 },
                        { value: 'medium', label: '3-4 items', addon: 40 },
                        { value: 'large', label: '5+ items', addon: 80 }
                    ]
                },
                {
                    id: 'wall_type',
                    label: 'What type of wall?',
                    options: [
                        { value: 'drywall', label: 'Drywall', addon: 0 },
                        { value: 'masonry', label: 'Brick/tile/concrete', addon: 40 }
                    ]
                }
            ]
        },
        floating_shelf: {
            hours: 1.0,
            label: "Floating Shelf Install",
            questions: [
                {
                    id: 'quantity',
                    label: 'How many shelves?',
                    options: [
                        { value: 'standard', label: '1-2 shelves (included)', addon: 0 },
                        { value: 'medium', label: '3-4 shelves', addon: 40 },
                        { value: 'large', label: '5+ shelves', addon: 80 }
                    ]
                },
                {
                    id: 'weight',
                    label: 'Shelf weight/size?',
                    options: [
                        { value: 'standard', label: 'Standard (under 25 lbs)', addon: 0 },
                        { value: 'heavy', label: 'Heavy-duty (over 25 lbs)', addon: 30 }
                    ]
                }
            ]
        },
        appliance_hookup: {
            hours: 1.5,
            label: "Appliance Hookup (W/D/DW)",
            questions: [
                {
                    id: 'appliance_type',
                    label: 'What appliance?',
                    options: [
                        { value: 'washer', label: 'Washer', addon: 0 },
                        { value: 'dryer', label: 'Dryer', addon: 0 },
                        { value: 'dishwasher', label: 'Dishwasher', addon: 0 },
                        { value: 'multiple', label: 'Multiple appliances', addon: 0 }
                    ]
                },
                {
                    id: 'old_removal',
                    label: 'Replacing an old unit?',
                    options: [
                        { value: 'remove', label: 'Yes, remove old', addon: 40 },
                        { value: 'new', label: 'No, new installation', addon: 0 },
                        { value: 'disconnect', label: 'Just disconnecting old', addon: 0 }
                    ]
                },
                {
                    id: 'hookups_ready',
                    label: 'Are hookups ready?',
                    options: [
                        { value: 'ready', label: 'Yes, all connections ready', addon: 0 },
                        { value: 'new_line', label: 'Need new vent/line', addon: 30 },
                        { value: 'unsure', label: 'Not sure', addon: 0 }
                    ]
                }
            ]
        },
        furniture_assembly: {
            hours: 1.5,
            label: "Furniture Assembly (S‚ÄìM)",
            questions: [
                {
                    id: 'furniture_type',
                    label: 'What type of furniture?',
                    options: [
                        { value: 'standard', label: 'Dresser/desk/table', addon: 0 },
                        { value: 'bed', label: 'Bed frame', addon: 30 },
                        { value: 'wardrobe', label: 'Large wardrobe', addon: 30 },
                        { value: 'multiple', label: 'Multiple small items', addon: 0 }
                    ]
                },
                {
                    id: 'quantity',
                    label: 'How many items?',
                    options: [
                        { value: 'single', label: '1 major item', addon: 0 },
                        { value: 'few', label: '2-3 small items', addon: 0 },
                        { value: 'many', label: '4+ items', addon: 40 }
                    ]
                }
            ]
        },
        closet_organizer: {
            hours: 2.0,
            label: "Closet Organizer Install",
            questions: [
                {
                    id: 'organizer_type',
                    label: 'Type of organizer?',
                    options: [
                        { value: 'standard', label: 'Shelves and rods', addon: 0 },
                        { value: 'modular', label: 'Modular cube system', addon: 0 },
                        { value: 'wire', label: 'Wire rack system', addon: 0 },
                        { value: 'custom', label: 'Custom wood system', addon: 0 }
                    ]
                },
                {
                    id: 'custom_fitting',
                    label: 'Need custom cutting?',
                    options: [
                        { value: 'no', label: 'No, standard sizes', addon: 0 },
                        { value: 'yes', label: 'Yes, custom fitting', addon: 50 },
                        { value: 'unsure', label: 'Not sure', addon: 0 }
                    ]
                },
                {
                    id: 'wall_type',
                    label: 'What type of wall?',
                    options: [
                        { value: 'drywall', label: 'Standard drywall', addon: 0 },
                        { value: 'masonry', label: 'Concrete/masonry', addon: 40 },
                        { value: 'unsure', label: 'Not sure', addon: 0 }
                    ]
                }
            ]
        },
        general_handyman: {
            hours: 2.0,
            label: "General Handyman (2+ hours)",
            questions: [
                {
                    id: 'task_complexity',
                    label: 'What type of tasks do you need done?',
                    options: [
                        { value: 'basic', label: 'Basic repairs, adjustments, or maintenance', addon: 0 },
                        { value: 'multiple', label: 'Multiple small tasks or repairs', addon: 0 },
                        { value: 'complex', label: 'More complex projects requiring planning', addon: 0 }
                    ]
                },
                {
                    id: 'additional_time',
                    label: 'Do you need additional time beyond 2 hours?',
                    options: [
                        { value: 'none', label: 'No, 2 hours should be sufficient', addon: 0 },
                        { value: 'one_block', label: 'Yes, add 3 more hours', addon: 180 },
                        { value: 'two_blocks', label: 'Yes, add 6 more hours', addon: 360 }
                    ]
                },
                {
                    id: 'materials_needed',
                    label: 'Will materials or parts be needed?',
                    options: [
                        { value: 'customer_supplies', label: 'I will provide all materials', addon: 0 },
                        { value: 'basic_supplies', label: 'May need basic supplies (screws, caulk, etc.)', addon: 0 },
                        { value: 'unsure', label: 'Not sure what will be needed', addon: 0 }
                    ]
                }
            ]
        },
        minor_repairs: { hours: 1.5, label: "Minor repairs", questions: [] }
    };

    const TIME_WINDOWS = {
        today_am: "Today (8‚Äì12)",
        today_pm: "Today (12‚Äì4)",
        today_eve: "Today (4‚Äì8)",
        tomorrow_am: "Tomorrow (8‚Äì12)",
        tomorrow_pm: "Tomorrow (12‚Äì4)"
    };

    // Time window mapping for sooner/later options
    const TIME_MAPPING = {
        today_am: { sooner: null, later: 'today_pm' },
        today_pm: { sooner: 'today_am', later: 'today_eve' },
        today_eve: { sooner: 'today_pm', later: 'tomorrow_am' },
        tomorrow_am: { sooner: 'today_eve', later: 'tomorrow_pm' },
        tomorrow_pm: { sooner: 'tomorrow_am', later: null }
    };

    // Debug logging function
    function debugPricingFlow(step, data) {
        console.log(`üîç PRICING DEBUG [${step}]:`, {
            selectedOption: selectedPricingOption?.type,
            window: selectedPricingOption?.window,
            amount: selectedPricingOption?.pricing?.total,
            additionalData: data
        });
    }

    // Initialize Stripe with error handling
    function initializeStripe() {
        if (typeof Stripe !== 'undefined') {
            if (!STRIPE_PUBLISHABLE_KEY.includes('YOUR_ACTUAL_STRIPE_KEY_HERE')) {
                try {
                    stripe = Stripe(STRIPE_PUBLISHABLE_KEY);
                    console.log('‚úÖ Stripe initialized successfully');
                } catch (error) {
                    console.error('‚ùå Stripe initialization failed:', error);
                }
            } else {
                console.error('‚ùå Please set your actual Stripe publishable key!');
            }
        } else {
            console.log('‚è≥ Stripe not loaded yet, retrying...');
            setTimeout(initializeStripe, 1000);
        }
    }

    // Generate unique task ID
    function generateTaskId() {
        const timestamp = Date.now().toString(36);
        const random = Math.random().toString(36).substring(2, 8);
        return `TASK-${timestamp}-${random}`.toUpperCase();
    }

    // Send SMS notification via Twilio
    async function sendSMSNotification(type, data) {
        try {
            console.log(`üì± Sending ${type} SMS notification...`);
            const response = await fetch('/.netlify/functions/send-sms', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    type: type,
                    data: data
                })
            });

            if (response.ok) {
                const result = await response.json();
                console.log(`‚úÖ ${type} SMS sent successfully:`, result.messageSid);
                return { success: true, data: result };
            } else {
                const error = await response.json();
                console.log(`‚ö†Ô∏è SMS ${type} failed:`, error.error);
                return { success: false, error: error.error };
            }
        } catch (error) {
            console.error(`‚ùå SMS ${type} error:`, error);
            return { success: false, error: error.message };
        }
    }

    // Send notification via Zapier Webhook
    async function sendZapierNotification(jobData) {
        if (!ZAPIER_CONFIG.ENABLED || ZAPIER_CONFIG.WEBHOOK_URL.includes('YOUR_ZAPIER_WEBHOOK_ID')) {
            console.log('‚ö†Ô∏è Zapier webhook not configured - skipping notification');
            return { success: false, message: 'Webhook not configured' };
        }

        // Prepare data for Zapier - clean and formatted
        const zapierData = {
            // Core job information
            task_id: jobData.task_id,
            timestamp: new Date().toISOString(),

            // Customer details
            customer_name: jobData.name,
            customer_phone: jobData.phone,
            customer_email: jobData.email,
            customer_zip: jobData.zip,
            customer_address: jobData.address || '',

            // Job details
            task_category: jobData.category,
            task_category_label: TASKS[jobData.category]?.label || jobData.category,
            time_window: jobData.window,
            description: jobData.description || 'None provided',
            rush_service: jobData.rush,

            // Pricing
            estimated_hours: jobData.estimated_hours,
            base_amount: jobData.base_amount,
            total_amount: jobData.total_amount,
            total_amount_formatted: '$' + jobData.total_amount.toFixed(2),
            premiums_applied: jobData.premiums?.map(p => p.label).join(', ') || 'None',

            // Property and access
            property_address: jobData.property_address,
            contact_phone: jobData.contact_phone,
            access_details: jobData.access_details || 'None provided',
            pets_and_special: jobData.pets_and_special || 'None provided',
            additional_details: jobData.additional_details || 'None provided',

            // Technical details
            payment_intent_id: jobData.payment_intent_id,
            step_scope: jobData.step_scope?.join(' ‚Ä¢ ') || 'Standard scope',
            risk_flags: jobData.risk_flags?.join(' ‚Ä¢ ') || 'No special risks noted',

            // Business data
            notification_email: 'info@sendahandyman.com'
        };

        try {
            console.log('üìß Sending notification via Zapier webhook...');
            console.log('üîó Webhook URL:', ZAPIER_CONFIG.WEBHOOK_URL);
            console.log('üì¶ Data being sent:', zapierData);

            // Try sending as URL-encoded form data (traditional POST)
            const params = new URLSearchParams();
            Object.keys(zapierData).forEach(key => {
                params.append(key, zapierData[key]);
            });

            const response = await fetch(ZAPIER_CONFIG.WEBHOOK_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: params.toString()
            });

            if (response.ok) {
                const result = await response.json();
                console.log('‚úÖ Zapier notification sent successfully:', result);
                return { success: true, data: result };
            } else {
                throw new Error(`Zapier webhook failed: ${response.status} ${response.statusText}`);
            }

        } catch (error) {
            console.error('‚ùå Zapier notification failed:', error);
            return { success: false, error: error.message };
        }
    }

    // Dynamic Q&A functionality
    function showTaskQuestions(taskKey) {
        const task = TASKS[taskKey];
        const questionsSection = document.getElementById('taskQuestions');
        const questionsContainer = document.getElementById('questionsContainer');

        if (!task || !task.questions || task.questions.length === 0) {
            questionsSection.classList.add('hidden');
            return;
        }

        questionsContainer.innerHTML = '';

        task.questions.forEach(question => {
            const questionDiv = document.createElement('div');
            questionDiv.className = 'space-y-2';

            const label = document.createElement('label');
            label.className = 'block text-sm font-semibold text-slate-700';
            label.textContent = question.label;

            const select = document.createElement('select');
            select.className = 'w-full rounded-lg border border-slate-200 px-3 py-2 text-sm';
            select.id = `question_${question.id}`;
            select.addEventListener('change', updateEstimateWithAddons);

            // Add default option
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = 'Please select...';
            select.appendChild(defaultOption);

            // Add question options
            question.options.forEach(option => {
                const optionElement = document.createElement('option');
                optionElement.value = option.value;
                optionElement.textContent = option.label + (option.addon > 0 ? ` (+$${option.addon})` : '');
                optionElement.dataset.addon = option.addon;
                select.appendChild(optionElement);
            });

            questionDiv.appendChild(label);
            questionDiv.appendChild(select);
            questionsContainer.appendChild(questionDiv);
        });

        questionsSection.classList.remove('hidden');
    }

    // Calculate add-ons from Q&A answers
    function calculateAddons(taskKey) {
        const task = TASKS[taskKey];
        if (!task || !task.questions) return 0;

        let totalAddons = 0;
        console.log('üîç Calculating addons for task:', taskKey);

        task.questions.forEach(question => {
            const select = document.getElementById(`question_${question.id}`);
            if (select && select.value) {
                const selectedOption = select.options[select.selectedIndex];
                const addon = parseInt(selectedOption.dataset.addon) || 0;
                console.log(`üìä Question ${question.id}: selected "${select.value}" with addon ${addon}`);
                totalAddons += addon;
            }
        });

        console.log('üí∞ Total addons calculated:', totalAddons);
        return totalAddons;
    }

    // Update pricing with add-ons (for real-time feedback)
    function updateEstimateWithAddons() {
        const taskKey = document.getElementById('taskCategory').value;
        if (!taskKey) return;

        const addons = calculateAddons(taskKey);
        // This function provides real-time feedback but final pricing happens in generateEstimate
        console.log('Current add-ons total:', addons);
    }

    function calculatePricing(hours, window, rush, addons = 0) {
        const base = hours * RATE;
        let premiums = [];
        let total = base + addons; // Add the add-ons to the base

        const sameDay = window.startsWith('today');
        const evening = window.includes('eve');

        if (sameDay) {
            const premium = base * PREMIUM_SAMEDAY;
            premiums.push({ label: 'Same-day premium (15%)', amount: premium });
            total += premium;
        }

        if (evening) {
            const premium = base * PREMIUM_EVENING;
            premiums.push({ label: 'Evening window premium (10%)', amount: premium });
            total += premium;
        }

        if (rush) {
            const premium = base * PREMIUM_RUSH;
            premiums.push({ label: 'Optional rush (10%)', amount: premium });
            total += premium;
        }

        if (addons > 0) {
            premiums.push({ label: 'Task-specific add-ons', amount: addons });
        }

        return { base, premiums, total, addons };
    }

    // STEP 2: Persist form data in memory
    function saveFormData() {
        console.log('üíæ Saving form data...');

        formData = {
            name: document.getElementById('customerName').value,
            phone: document.getElementById('customerPhone').value,
            email: document.getElementById('customerEmail').value,
            zip: document.getElementById('customerZip').value,
            address: document.getElementById('customerAddress').value,
            category: document.getElementById('taskCategory').value,
            window: document.getElementById('taskWindow').value,
            description: document.getElementById('taskDescription').value,
            rush: document.getElementById('rushOption').checked
        };

        console.log('‚úÖ Form data saved to memory:', formData);
        return formData;
    }

    // STEP 3: Progress animation and AI estimate
    function showEstimateProgress() {
        const btn = document.getElementById('getEstimateBtn');
        const progressBg = document.getElementById('progressBg');
        const text = document.getElementById('estimateText');
        const container = document.getElementById('progressContainer');
        const bar = document.getElementById('progressBar');
        const message = document.getElementById('progressMessage');

        btn.disabled = true;
        container.classList.remove('hidden');

        // Stage 1: Start (25%)
        text.textContent = 'üì§ Uploading photos...';
        message.textContent = 'Uploading photos and analyzing task...';
        progressBg.style.transform = 'translateX(-75%)';
        bar.style.width = '25%';

        setTimeout(() => {
            // Stage 2: Processing (60%)
            text.textContent = 'ü§ñ AI analyzing...';
            message.textContent = 'AI is analyzing your photos and requirements...';
            progressBg.style.transform = 'translateX(-40%)';
            bar.style.width = '60%';
        }, 1500);

        setTimeout(() => {
            // Stage 3: Finalizing (90%)
            text.textContent = 'üí≠ Generating options...';
            message.textContent = 'Creating your pricing options...';
            progressBg.style.transform = 'translateX(-10%)';
            bar.style.width = '90%';
        }, 3000);

        setTimeout(() => {
            // Stage 4: Complete (100%)
            text.textContent = '‚úÖ Options ready!';
            message.textContent = 'Analysis complete! Options generated.';
            progressBg.style.transform = 'translateX(0%)';
            bar.style.width = '100%';
        }, 4000);
    }

    function resetEstimateProgress() {
        const btn = document.getElementById('getEstimateBtn');
        const progressBg = document.getElementById('progressBg');
        const text = document.getElementById('estimateText');
        const container = document.getElementById('progressContainer');
        const bar = document.getElementById('progressBar');

        setTimeout(() => {
            btn.disabled = false;
            text.textContent = 'üîß Get pricing options';
            container.classList.add('hidden');
            progressBg.style.transform = 'translateX(-100%)';
            bar.style.width = '0%';
        }, 1000);
    }

    async function generateEstimate() {
        console.log('üîÑ Generate estimate button clicked!');

        try {
            const data = saveFormData();
            console.log('üìã Form data collected:', data);

            // Validate required fields
            if (!data.name || !data.phone || !data.email || !data.category) {
                console.error('‚ùå Missing required fields:', {
                    name: data.name,
                    phone: data.phone,
                    email: data.email,
                    category: data.category
                });
                alert('Please fill out all required fields (Name, Phone, Email, and Task)');
                return;
            }

            console.log('‚úÖ Validation passed, starting progress animation...');
            showEstimateProgress();

            // Call AI scope function
            const hours = TASKS[data.category]?.hours || 1.5;
            const addons = calculateAddons(data.category); // Calculate add-ons from Q&A

            const aiPayload = {
                category: data.category,
                description: data.description,
                base_rate_hr: RATE,
                hours_base: hours,
                window: data.window,
                rush: data.rush,
                addons: addons, // Include add-ons in AI payload
                name: data.name,
                phone: data.phone,
                email: data.email,
                address: data.address
            };

            console.log('üì§ Calling AI scope function with payload:', aiPayload);

            const response = await fetch('/.netlify/functions/scope', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(aiPayload)
            });

            console.log('üì° AI scope response status:', response.status);

            if (!response.ok) {
                const errorText = await response.text();
                console.error('‚ùå AI scope failed:', response.status, errorText);
                throw new Error(`AI estimate failed: ${response.status}`);
            }

            const aiResult = await response.json();
            console.log('üìä AI scope result:', aiResult);

            // Generate multiple pricing options with add-ons
            const pricingOptions = generatePricingOptions(hours, data.window, data.rush, addons);
            console.log('üí∞ Generated pricing options:', pricingOptions);

            // Store estimate data
            estimateData = {
                ...aiResult,
                hours,
                pricingOptions
            };

            console.log('‚úÖ Estimate data stored:', estimateData);

            // Wait for progress to complete, then show estimate
            setTimeout(() => {
                console.log('üéØ Showing estimate panel...');
                showEstimatePanel(estimateData);
                resetEstimateProgress();
            }, 4500);

        } catch (error) {
            console.error('‚ùå Generate estimate error:', error);
            console.error('Error stack:', error.stack);
            alert('Failed to generate estimate: ' + error.message);
            resetEstimateProgress();
        }
    }

    function generatePricingOptions(hours, selectedWindow, rush, addons = 0) {
        const options = [];
        const mapping = TIME_MAPPING[selectedWindow];

        // Calculate base pricing for selected option
        const selectedPricing = calculatePricing(hours, selectedWindow, rush, addons);

        // Option 1: Sooner (+20%)
        if (mapping.sooner) {
            const soonerPricing = calculatePricing(hours, mapping.sooner, rush, addons);
            const soonerTotal = soonerPricing.total * (1 + PREMIUM_SOONER);
            options.push({
                type: 'sooner',
                window: mapping.sooner,
                windowLabel: TIME_WINDOWS[mapping.sooner],
                pricing: {
                    ...soonerPricing,
                    total: soonerTotal,
                    premiums: [...soonerPricing.premiums, { label: 'Sooner premium (20%)', amount: soonerPricing.total * PREMIUM_SOONER }]
                },
                badge: 'Premium',
                badgeClass: 'premium'
            });
        }

        // Option 2: Selected (middle)
        options.push({
            type: 'selected',
            window: selectedWindow,
            windowLabel: TIME_WINDOWS[selectedWindow],
            pricing: selectedPricing,
            badge: 'Your Choice',
            badgeClass: 'selected'
        });

        // Option 3: Later (-10%)
        if (mapping.later) {
            const laterPricing = calculatePricing(hours, mapping.later, rush, addons);
            const laterTotal = laterPricing.total * (1 - DISCOUNT_LATER);
            options.push({
                type: 'later',
                window: mapping.later,
                windowLabel: TIME_WINDOWS[mapping.later],
                pricing: {
                    ...laterPricing,
                    total: laterTotal,
                    premiums: [...laterPricing.premiums, { label: 'Later discount (-10%)', amount: -laterPricing.total * DISCOUNT_LATER }]
                },
                badge: 'Save',
                badgeClass: 'discount'
            });
        }

        return options;
    }

    function showEstimatePanel(estimate) {
        // Generate pricing option cards
        const optionsContainer = document.getElementById('pricingOptions');
        optionsContainer.innerHTML = '';

        estimate.pricingOptions.forEach((option, index) => {
            const optionCard = document.createElement('div');
            optionCard.className = 'pricing-option relative border-2 border-slate-200 rounded-xl p-4 cursor-pointer';
            optionCard.dataset.optionType = option.type;
            optionCard.dataset.window = option.window;

            optionCard.innerHTML = `
                <div class="pricing-badge ${option.badgeClass}">${option.badge}</div>
                <div class="flex items-center justify-between">
                    <div>
                        <div class="font-semibold text-lg">${option.windowLabel}</div>
                        <div class="text-sm text-slate-600">${estimate.hours.toFixed(1)} hours estimated</div>
                    </div>
                    <div class="text-right">
                        <div class="text-2xl font-bold">$${option.pricing.total.toFixed(0)}</div>
                        ${option.type !== 'selected' ? `<div class="text-sm text-slate-500">vs $${estimate.pricingOptions.find(o => o.type === 'selected').pricing.total.toFixed(0)}</div>` : ''}
                    </div>
                </div>
            `;

            // Add click handler
            optionCard.addEventListener('click', () => selectPricingOption(option, optionCard));

            optionsContainer.appendChild(optionCard);

            // Auto-select the middle option
            if (option.type === 'selected') {
                setTimeout(() => selectPricingOption(option, optionCard), 100);
            }
        });

        // Scope and risks
        document.getElementById('estimateScope').innerHTML = (estimate.step_scope || []).map(s => `<li>${s}</li>`).join('');
        document.getElementById('estimateRisks').innerHTML = (estimate.risk_flags || []).map(r => `<li>${r}</li>`).join('');

        document.getElementById('estimatePanel').classList.remove('hidden');

        // Scroll to estimate
        document.getElementById('estimatePanel').scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    function selectPricingOption(option, cardElement) {
        // Remove selection from all cards
        document.querySelectorAll('.pricing-option').forEach(card => {
            card.classList.remove('selected');
        });

        // Add selection to clicked card
        cardElement.classList.add('selected');

        // Store selected option with validation
        selectedPricingOption = {
            ...option,
            // Ensure we have all required fields
            window: option.window,
            windowLabel: option.windowLabel,
            type: option.type,
            pricing: { ...option.pricing }
        };

        // Enable reserve button
        document.getElementById('reserveBtn').disabled = false;

        debugPricingFlow('OPTION_SELECTED', option);
        console.log('‚úÖ Selected pricing option:', selectedPricingOption);
        console.log('üîç Selected window:', selectedPricingOption.window);
        console.log('üí∞ Selected amount:', selectedPricingOption.pricing.total);
    }

    // STEP 4: Payment processing
    async function showPaymentModal() {
        if (!selectedPricingOption) {
            alert('Please select a pricing option first');
            return;
        }

        if (!stripe) {
            alert('Payment system is still loading. Please try again in a moment.');
            return;
        }

        // Recalculate addons with current Q&A values to ensure accuracy
        const currentAddons = calculateAddons(formData.category);
        const hours = TASKS[formData.category]?.hours || 1.5;

        // Recalculate pricing with current addons
        const updatedPricing = calculatePricing(hours, selectedPricingOption.window, formData.rush, currentAddons);
        console.log('üí∞ Updated pricing for payment modal:', updatedPricing);

        // Update the selected pricing option with recalculated values
        selectedPricingOption.pricing = updatedPricing;

        debugPricingFlow('PAYMENT_MODAL_OPENED', updatedPricing);

        // Show the modal with correct amount
        document.getElementById('paymentAmount').textContent = '$' + updatedPricing.total.toFixed(0);
        document.getElementById('paymentTiming').textContent = selectedPricingOption.windowLabel;
        document.getElementById('paymentModal').classList.remove('hidden');

        // Reset payment element ready state
        paymentElementReady = false;

        try {
            console.log('üîÑ Setting up payment intent...');
            const response = await fetch('/.netlify/functions/create-payment', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    amount: updatedPricing.total, // Use recalculated amount
                    customer_info: formData,
                    job_details: {
                        category: formData.category,
                        window: selectedPricingOption.window, // Use selected window
                        hours: estimateData.hours,
                        selected_option_type: selectedPricingOption.type // Add this for debugging
                    }
                })
            });

            if (!response.ok) {
                throw new Error('Payment setup failed');
            }

            const result = await response.json();
            paymentIntentId = result.payment_intent_id;

            console.log('üí≥ Initializing Stripe Elements with client secret...');

            // Clear any existing elements
            if (paymentElement) {
                try {
                    paymentElement.unmount();
                } catch (e) {
                    console.log('Previous payment element unmount warning (safe to ignore):', e.message);
                }
            }

            elements = stripe.elements({
                clientSecret: result.client_secret,
                appearance: {
                    theme: 'stripe'
                }
            });

            paymentElement = elements.create('payment', {
                layout: 'tabs'
            });

            // Wait for element to be ready
            await new Promise((resolve, reject) => {
                paymentElement.mount('#stripe-payment-element');

                paymentElement.on('ready', () => {
                    console.log('‚úÖ Payment element mounted and ready');
                    paymentElementReady = true;
                    resolve();
                });

                paymentElement.on('error', (error) => {
                    console.error('‚ùå Payment element error:', error);
                    reject(error);
                });

                // Timeout fallback
                setTimeout(() => {
                    if (!paymentElementReady) {
                        console.log('‚ö†Ô∏è Payment element ready timeout, assuming mounted');
                        paymentElementReady = true;
                    }
                    resolve();
                }, 3000);
            });

        } catch (error) {
            console.error('‚ùå Payment setup error:', error);
            document.getElementById('paymentMessage').textContent = 'Payment setup failed. Please try again.';
            document.getElementById('paymentMessage').classList.remove('hidden');
            document.getElementById('paymentMessage').className = 'mt-4 text-sm text-red-600';
        }
    }

    async function processPayment(event) {
        event.preventDefault();

        const submitBtn = document.getElementById('submitPayment');
        const btnText = document.getElementById('paymentButtonText');

        // Validate that payment element is ready
        if (!elements || !paymentElement || !paymentElementReady) {
            alert('Payment form is not properly initialized. Please refresh and try again.');
            return;
        }

        submitBtn.disabled = true;
        btnText.textContent = 'Processing payment...';

        // Clear any previous error messages
        document.getElementById('paymentMessage').classList.add('hidden');

        debugPricingFlow('PAYMENT_PROCESSING', null);

        try {
            console.log('üîÑ Confirming payment for amount:', selectedPricingOption.pricing.total);

            const { error, paymentIntent } = await stripe.confirmPayment({
                elements,
                confirmParams: {
                    return_url: window.location.origin + window.location.pathname
                },
                redirect: 'if_required'
            });

            if (error) {
                throw new Error(error.message);
            }

            if (paymentIntent && paymentIntent.status === 'succeeded') {
                console.log('‚úÖ Payment successful:', paymentIntent.id);
                console.log('üí∞ Amount charged:', paymentIntent.amount / 100);
                paymentIntentId = paymentIntent.id;

                // Hide payment modal and show Task Information modal
                document.getElementById('paymentModal').classList.add('hidden');
                showTaskInfoModal();
            } else {
                throw new Error('Payment was not completed successfully');
            }

        } catch (error) {
            console.error('‚ùå Payment failed:', error);
            document.getElementById('paymentMessage').textContent = error.message;
            document.getElementById('paymentMessage').classList.remove('hidden');
            document.getElementById('paymentMessage').className = 'mt-4 text-sm text-red-600';

            submitBtn.disabled = false;
            btnText.textContent = 'Complete Payment';
        }
    }

    // STEP 5: Show Task Information modal with pre-populated data
    function showTaskInfoModal() {
        // Generate and store task ID
        const taskId = generateTaskId();
        window.currentTaskId = taskId; // Store for later use

        // Pre-populate summary from Step 2 data and selected option
        document.getElementById('summaryTaskId').textContent = taskId;
        document.getElementById('summaryName').textContent = formData.name;
        document.getElementById('summaryPhone').textContent = formData.phone;
        document.getElementById('summaryEmail').textContent = formData.email;
        document.getElementById('summaryTask').textContent = TASKS[formData.category]?.label || formData.category;
        document.getElementById('summaryWindow').textContent = selectedPricingOption.windowLabel;
        document.getElementById('summaryDescription').textContent = formData.description || 'None provided';

        // Pre-populate contact phone with customer phone
        document.getElementById('contactPhone').value = formData.phone;

        document.getElementById('taskInfoModal').classList.remove('hidden');
    }

    // STEP 6: Send notification and complete flow
    async function submitTaskInfo(event) {
        event.preventDefault();

        const submitBtn = event.target.querySelector('button[type="submit"]');
        submitBtn.disabled = true;
        submitBtn.textContent = 'üì§ Sending notification...';

        // Use the task ID generated when modal was shown
        const taskId = window.currentTaskId;

        // Ensure we have fresh form data
        const currentFormData = saveFormData();
        console.log('üìã Fresh form data for notification:', currentFormData);

        // Validate that we have required data
        if (!currentFormData.name || !currentFormData.phone || !currentFormData.email || !currentFormData.category) {
            console.error('‚ùå Missing critical form data:', currentFormData);
            alert('Critical form data is missing. Please refresh and try again.');
            submitBtn.disabled = false;
            submitBtn.textContent = 'üöÄ Dispatch Handyman';
            return;
        }

        // Collect all data for notification using selected pricing option
        const completeJobData = {
            // Flat structure (new)
            task_id: taskId,
            payment_intent_id: paymentIntentId,
            category: currentFormData.category,
            window: selectedPricingOption.window, // Use selected window, not original
            name: currentFormData.name,
            phone: currentFormData.phone,
            email: currentFormData.email,
            zip: currentFormData.zip,
            address: currentFormData.address || '',
            description: currentFormData.description || '',
            rush: currentFormData.rush || false,
            property_address: document.getElementById('propertyAddress').value,
            contact_phone: document.getElementById('contactPhone').value,
            access_details: document.getElementById('accessDetails').value || '',
            pets_and_special: document.getElementById('petsAndSpecial').value || '',
            additional_details: document.getElementById('additionalDetails').value || '',
            estimated_hours: estimateData.hours,
            total_amount: selectedPricingOption.pricing.total,
            base_amount: selectedPricingOption.pricing.base,
            premiums: selectedPricingOption.pricing.premiums || [],
            step_scope: estimateData.step_scope || [],
            risk_flags: estimateData.risk_flags || [],

            // Original nested structure (fallback for backward compatibility)
            customer: {
                name: currentFormData.name,
                phone: currentFormData.phone,
                email: currentFormData.email,
                zip: currentFormData.zip,
                address: currentFormData.address || '',
                category: currentFormData.category,
                window: selectedPricingOption.window, // Use selected window
                description: currentFormData.description || '',
                rush: currentFormData.rush || false
            },
            task_info: {
                property_address: document.getElementById('propertyAddress').value,
                contact_phone: document.getElementById('contactPhone').value,
                access_details: document.getElementById('accessDetails').value || '',
                pets_and_special: document.getElementById('petsAndSpecial').value || '',
                additional_details: document.getElementById('additionalDetails').value || ''
            },
            estimate: {
                hours: estimateData.hours,
                pricing: selectedPricingOption.pricing,
                step_scope: estimateData.step_scope || [],
                risk_flags: estimateData.risk_flags || []
            },
            amount: selectedPricingOption.pricing.total
        };

        console.log('üìã Complete job data being sent to notification:', completeJobData);
        console.log('üîç Key fields check:', {
            name: completeJobData.name,
            category: completeJobData.category,
            phone: completeJobData.phone,
            email: completeJobData.email,
            window: completeJobData.window
        });

        // Send SMS confirmation to customer
        try {
            await sendSMSNotification('booking_confirmation', {
                customer_phone: completeJobData.phone,
                task_id: taskId,
                service_name: TASKS[completeJobData.category]?.label,
                time_window: TIME_WINDOWS[completeJobData.window],
                total_amount: selectedPricingOption.pricing.total.toFixed(0)
            });
        } catch (smsError) {
            console.log('üì± SMS failed but continuing:', smsError);
        }

        // Send Zapier notification
        let zapierResult = null;
        try {
            zapierResult = await sendZapierNotification(completeJobData);
            if (zapierResult.success) {
                console.log('‚úÖ Zapier notification sent successfully');
            } else {
                console.log('‚ö†Ô∏è Zapier notification not sent:', zapierResult.message);
            }
        } catch (zapierError) {
            console.error('‚ùå Zapier notification failed:', zapierError);
            // Don't block the process if Zapier fails
        }

        try {
            const response = await fetch('/.netlify/functions/send-notification', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(completeJobData)
            });

            console.log('üì° Notification response status:', response.status);

            if (response.ok) {
                const result = await response.json();
                console.log('‚úÖ Notification sent successfully:', result);
            } else {
                const error = await response.text();
                console.error('‚ùå Notification failed:', response.status, error);
            }
        } catch (error) {
            console.error('‚ùå Notification error:', error);
        }

        // Show final success regardless of notification status
        document.getElementById('finalTaskId').textContent = taskId;
        document.getElementById('taskInfoModal').classList.add('hidden');
        document.getElementById('finalSuccessModal').classList.remove('hidden');
    }

    // Mobile Menu functionality
    function initializeMobileMenu() {
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const mobileMenu = document.getElementById('mobile-menu');

        mobileMenuBtn.addEventListener('click', () => {
            mobileMenu.classList.toggle('active');
        });

        // Close mobile menu when clicking on a link
        document.querySelectorAll('#mobile-menu a').forEach(link => {
            link.addEventListener('click', () => {
                mobileMenu.classList.remove('active');
            });
        });

        // Close mobile menu when clicking outside
        document.addEventListener('click', (e) => {
            if (!mobileMenuBtn.contains(e.target) && !mobileMenu.contains(e.target)) {
                mobileMenu.classList.remove('active');
            }
        });
    }

    // Chatbot functionality
    function initializeChatbot() {
        const chatToggle = document.getElementById('chatbot-toggle');
        const chatWindow = document.getElementById('chatbot-window');
        const chatClose = document.getElementById('chatbot-close');
        const chatInput = document.getElementById('chatbot-input');
        const chatSend = document.getElementById('chatbot-send');
        const chatMessages = document.getElementById('chatbot-messages');

        let conversationHistory = [];
        let isOpen = false;

        // Toggle chat window
        chatToggle.addEventListener('click', () => {
            isOpen = !isOpen;
            if (isOpen) {
                chatWindow.classList.remove('hidden');
                chatInput.focus();
            } else {
                chatWindow.classList.add('hidden');
            }
        });

        // Close chat window
        chatClose.addEventListener('click', () => {
            isOpen = false;
            chatWindow.classList.add('hidden');
        });

        // Send message on Enter key
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // Send message on button click
        chatSend.addEventListener('click', sendMessage);

        async function sendMessage() {
            const message = chatInput.value.trim();
            if (!message) return;

            // Add user message to chat
            addMessage(message, 'user');
            chatInput.value = '';

            // Show typing indicator
            const typingIndicator = addTypingIndicator();

            try {
                const response = await fetch('/.netlify/functions/chatbot', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: message,
                        conversationHistory: conversationHistory
                    })
                });

                // Remove typing indicator
                typingIndicator.remove();

                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }

                const result = await response.json();

                if (result.error) {
                    addMessage(result.error, 'bot', true);
                } else {
                    addMessage(result.reply, 'bot');
                }

                // Update conversation history
                conversationHistory.push(
                    { role: 'human', content: message },
                    { role: 'assistant', content: result.reply || 'Error occurred' }
                );

                // Keep only last 10 exchanges to manage context length
                if (conversationHistory.length > 20) {
                    conversationHistory = conversationHistory.slice(-20);
                }

            } catch (error) {
                console.error('Chatbot error:', error);
                typingIndicator.remove();
                addMessage('Sorry, I\'m having trouble connecting right now. Please try again or contact us directly at info@sendahandyman.com', 'bot', true);
            }
        }

        function addMessage(content, sender, isError = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'flex items-start space-x-2';

            if (sender === 'user') {
                messageDiv.innerHTML = `
                    <div class="flex-1"></div>
                    <div class="bg-indigo-600 text-white rounded-lg p-3 max-w-xs">
                        <p class="text-sm">${escapeHtml(content)}</p>
                    </div>
                    <div class="w-8 h-8 rounded-full bg-indigo-600 flex items-center justify-center flex-shrink-0">
                        <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                    </div>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div class="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center flex-shrink-0">
                        <svg class="w-4 h-4 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                        </svg>
                    </div>
                    <div class="bg-slate-100 rounded-lg p-3 max-w-xs ${isError ? 'border border-red-200 bg-red-50' : ''}">
                        <p class="text-sm text-slate-700">${formatBotMessage(content)}</p>
                    </div>
                `;
            }

            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function addTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.className = 'flex items-start space-x-2';
            typingDiv.innerHTML = `
                <div class="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center flex-shrink-0">
                    <svg class="w-4 h-4 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                    </svg>
                </div>
                <div class="bg-slate-100 rounded-lg p-3">
                    <p class="text-sm text-slate-500 chatbot-typing">Typing</p>
                </div>
            `;

            chatMessages.appendChild(typingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            return typingDiv;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function formatBotMessage(content) {
            // Convert line breaks to <br> tags and preserve formatting
            return escapeHtml(content)
                .replace(/\n/g, '<br>')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>');
        }

        console.log('‚úÖ Chatbot initialized');
    }

    // Event Listeners
    document.addEventListener('DOMContentLoaded', () => {
        console.log('üöÄ DOM Content Loaded - Initializing app...');

        // Initialize Stripe
        initializeStripe();

        console.log('üéØ Zapier webhook configured:', ZAPIER_CONFIG.ENABLED ? 'YES' : 'NO');

        // Initialize mobile menu
        initializeMobileMenu();

        // Service card expand/collapse functionality - CRITICAL FUNCTIONALITY RESTORED
        document.querySelectorAll('.service-card').forEach(card => {
            card.addEventListener('click', (e) => {
                const taskKey = card.getAttribute('data-task');
                const details = card.querySelector('.service-details');
                const icon = card.querySelector('.expand-icon');

                // Close all other cards
                document.querySelectorAll('.service-card').forEach(otherCard => {
                    if (otherCard !== card) {
                        const otherDetails = otherCard.querySelector('.service-details');
                        const otherIcon = otherCard.querySelector('.expand-icon');
                        otherDetails.classList.add('hidden');
                        otherIcon.style.transform = 'rotate(0deg)';
                    }
                });

                // Toggle current card
                if (details.classList.contains('hidden')) {
                    details.classList.remove('hidden');
                    icon.style.transform = 'rotate(180deg)';

                    // Auto-select this task in the form and scroll to booking
                    document.getElementById('taskCategory').value = taskKey;
                    showTaskQuestions(taskKey); // Show dynamic Q&A

                    setTimeout(() => {
                        document.getElementById('book').scrollIntoView({ behavior: 'smooth' });
                    }, 500);
                } else {
                    details.classList.add('hidden');
                    icon.style.transform = 'rotate(0deg)';
                }
            });
        });

        // Task dropdown change handler
        document.getElementById('taskCategory').addEventListener('change', (e) => {
            const taskKey = e.target.value;
            if (taskKey) {
                showTaskQuestions(taskKey);
            } else {
                document.getElementById('taskQuestions').classList.add('hidden');
            }
        });

        console.log('‚úÖ Service selection system initialized');

        // Photo upload preview
        document.getElementById('taskPhotos').addEventListener('change', (e) => {
            const thumbs = document.getElementById('photoThumbs');
            thumbs.innerHTML = '';
            [...e.target.files].slice(0, 5).forEach(file => {
                const url = URL.createObjectURL(file);
                const img = document.createElement('img');
                img.src = url;
                img.className = 'h-16 w-16 object-cover rounded-lg border';
                thumbs.appendChild(img);
            });
        });

        // STEP 3: Get Estimate Button
        document.getElementById('getEstimateBtn').addEventListener('click', generateEstimate);

        // STEP 4: Reserve Button
        document.getElementById('reserveBtn').addEventListener('click', showPaymentModal);

        // Payment form
        document.getElementById('paymentForm').addEventListener('submit', processPayment);

        // Close payment modal
        document.getElementById('closePayment').addEventListener('click', () => {
            document.getElementById('paymentModal').classList.add('hidden');
        });

        // STEP 5: Task Info Form
        document.getElementById('taskInfoForm').addEventListener('submit', submitTaskInfo);

        // Final success close
        document.getElementById('closeFinalSuccess').addEventListener('click', () => {
            document.getElementById('finalSuccessModal').classList.add('hidden');
            location.reload(); // Reset for new booking
        });

        // Set current year and version
        document.getElementById('year').textContent = new Date().getFullYear();
        document.getElementById('version').textContent = APP_VERSION;

        console.log('üéØ All event listeners initialized successfully');

        // Initialize chatbot
        initializeChatbot();
    });

    console.log('üìú JavaScript finished loading');
</script>
</body>
</html>