<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>SendAHandyman — Same-Day / Next-Day Handyman Dispatch</title>
    <meta name="description" content="Book a vetted handyman today or tomorrow. Upload photos, get an instant AI estimate, and reserve with your card. Serving Palm Beach, Broward & Miami-Dade." />
    <script async src="https://www.googletagmanager.com/gtag/js?id=AW-17598022946"></script>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-PW9HC7HL');</script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'AW-17598022946');
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://js.stripe.com/v3/"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png">
    <style>
        body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji"}
        .shadow-soft{box-shadow:0 10px 30px rgba(0,0,0,.06)}
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        .pricing-option {
            transition: all 0.2s ease;
            margin-bottom: 0.75rem;
        }
        .pricing-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,.1);
        }
        .pricing-option.selected {
            border-color: #4f46e5;
            background-color: #f8fafc;
        }
        .pricing-badge {
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            background: #4f46e5;
            color: white;
            font-size: 0.75rem;
            padding: 2px 8px;
            border-radius: 12px;
            font-weight: 600;
        }
        .pricing-badge.premium {
            background: #dc2626;
        }
        .pricing-badge.discount {
            background: #059669;
        }
        .chatbot-typing {
            display: inline-block;
        }
        .chatbot-typing::after {
            content: '';
            animation: chatbot-dots 1.5s infinite;
        }
        @keyframes chatbot-dots {
            0%, 20% { content: ''; }
            40% { content: '.'; }
            60% { content: '..'; }
            80%, 100% { content: '...'; }
        }
        .carousel-container {
            position: relative;
            overflow: hidden;
            border-radius: 0.75rem;
        }
        .carousel-track {
            display: flex;
            animation: carousel-scroll 24s linear infinite;
        }
        .carousel-slide {
            min-width: 100%;
            aspect-ratio: 16/9;
            background-size: cover;
            background-position: center;
        }
        @keyframes carousel-scroll {
            0% { transform: translateX(0); }
            16.66% { transform: translateX(0); }
            20% { transform: translateX(-100%); }
            36.66% { transform: translateX(-100%); }
            40% { transform: translateX(-200%); }
            56.66% { transform: translateX(-200%); }
            60% { transform: translateX(-300%); }
            76.66% { transform: translateX(-300%); }
            80% { transform: translateX(-400%); }
            96.66% { transform: translateX(-400%); }
            100% { transform: translateX(-500%); }
        }
        .carousel-container:hover .carousel-track {
            animation-play-state: paused;
        }
        #chatbot-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
        #chatbot-toggle {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            border: none;
            border-radius: 50%;
            width: 70px;
            height: 70px;
            box-shadow: 0 8px 25px rgba(79, 70, 229, 0.4);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        #chatbot-toggle:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(79, 70, 229, 0.6);
            background: linear-gradient(135deg, #3730a3 0%, #6d28d9 100%);
        }
        #chatbot-toggle:active {
            transform: translateY(-1px);
        }
        #chatbot-toggle::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            animation: chatbot-pulse 2s infinite;
        }
        @keyframes chatbot-pulse {
            0% {
                transform: scale(1);
                opacity: 0.7;
            }
            50% {
                transform: scale(1.1);
                opacity: 0.3;
            }
            100% {
                transform: scale(1);
                opacity: 0.7;
            }
        }
        #chatbot-toggle svg {
            width: 32px;
            height: 32px;
            z-index: 2;
            position: relative;
        }
        #chatbot-toggle::after {
            content: 'Need help? Click to chat!';
            position: absolute;
            right: 85px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 14px;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            pointer-events: none;
        }
        #chatbot-toggle:hover::after {
            opacity: 1;
            visibility: visible;
            right: 80px;
        }
        .chatbot-notification {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ef4444;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            animation: bounce 1s infinite;
        }
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-5px);
            }
            60% {
                transform: translateY(-3px);
            }
        }
        #chatbot-window {
            width: 380px;
            height: 500px;
            bottom: 100px;
            right: 0;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
        }
        .mobile-menu-btn {
            display: none;
        }
        .mobile-menu {
            display: none;
        }
        @media (max-width: 768px) {
            .mobile-menu-btn {
                display: block;
            }
            .desktop-nav {
                display: none;
            }
            .mobile-menu.active {
                display: block;
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                background: white;
                border-top: 1px solid #e2e8f0;
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
                z-index: 50;
            }
            .mobile-menu a {
                display: block;
                padding: 12px 16px;
                border-bottom: 1px solid #f1f5f9;
                color: #475569;
                text-decoration: none;
            }
            .mobile-menu a:hover {
                background: #f8fafc;
                color: #4f46e5;
            }
            .mobile-header-row-2 {
                margin-top: 0.5rem;
            }
            #chatbot-container {
                bottom: 15px;
                right: 15px;
            }
            #chatbot-toggle {
                width: 65px;
                height: 65px;
            }
            #chatbot-toggle svg {
                width: 28px;
                height: 28px;
            }
            #chatbot-toggle::after {
                display: none;
            }
            #chatbot-window {
                width: 95vw;
                height: 70vh;
                right: 2.5vw;
                bottom: 85px;
            }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">
<header class="bg-white/80 backdrop-blur sticky top-0 z-40 border-b border-slate-100">
    <div class="max-w-6xl mx-auto px-4 py-3 relative">
        <div class="hidden md:flex items-center justify-between">
            <a href="index.html" class="flex items-center gap-2 hover:opacity-80 transition-opacity">
                <img src="/images/helpinghands_logo.png" alt="Helping Hands Logo" class="h-9 w-auto">
                <span class="font-semibold">SendAHandyman</span>
            </a>
            <nav class="desktop-nav flex items-center gap-6 text-sm">
                <a href="#how" class="hover:text-indigo-600">How it works</a>
                <a href="#book" class="hover:text-indigo-600">Book now</a>
                <a href="concierge.html" class="hover:text-indigo-600">Concierge</a>
                <a href="#coverage" class="hover:text-indigo-600">Coverage</a>
                <a href="#faq" class="hover:text-indigo-600">FAQ</a>
                <a href="join-team.html" class="hover:text-green-600 font-semibold">💼 Join Our Team</a>
            </nav>
            <a href="#book" class="inline-flex items-center gap-2 rounded-xl bg-indigo-600 px-4 py-2 text-white text-sm font-semibold shadow-soft">Book same-day</a>
        </div>
        <div class="md:hidden">
            <div class="flex items-center justify-between">
                <a href="index.html" class="flex items-center gap-2 hover:opacity-80 transition-opacity">
                    <img src="/images/helpinghands_logo.png" alt="Helping Hands Logo" class="h-9 w-auto">
                    <span class="font-semibold">SendAHandyman</span>
                </a>
                <button class="mobile-menu-btn p-2" id="mobile-menu-btn">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
            </div>
            <div class="mobile-header-row-2 flex justify-center">
                <a href="#book" class="inline-flex items-center gap-2 rounded-xl bg-indigo-600 px-4 py-2 text-white text-sm font-semibold shadow-soft">Book same-day</a>
            </div>
        </div>
        <div class="mobile-menu" id="mobile-menu">
            <a href="#how">How it works</a>
            <a href="#book">Book now</a>
            <a href="concierge.html">Concierge</a>
            <a href="#coverage">Coverage</a>
            <a href="#faq">FAQ</a>
            <a href="join-team.html">Join Our Team</a>
        </div>
    </div>
</header>

<section class="bg-gradient-to-b from-white to-slate-50">
    <div class="max-w-6xl mx-auto px-4 py-10 md:py-16 grid md:grid-cols-2 gap-10 items-center">
        <div>
            <h1 class="text-3xl md:text-5xl font-extrabold leading-tight">Local handyman help — <span class="text-indigo-600">today or tomorrow</span>.</h1>
            <p class="mt-3 text-xl font-medium text-slate-800">Skip the contractor shopping. Just pick your task and we dispatch the right pro.</p>
            <p class="mt-4 text-slate-600 text-lg">Upload photos, get an instant AI estimate, and reserve with your card. We dispatch a vetted pro and text you updates. Serving Palm Beach, Broward & Miami-Dade.</p>
            <ul class="mt-6 space-y-2 text-slate-700">
                <li>✅ Vetted & background-checked pros</li>
                <li>✅ Fixed pricing + transparent same-day premium</li>
                <li>✅ Same-day / next-day time windows</li>
            </ul>
            <div class="mt-6 flex gap-3">
                <a href="#book" class="rounded-xl bg-indigo-600 px-5 py-3 text-white font-semibold shadow-soft">Start your request</a>
                <a href="#how" class="rounded-xl bg-white px-5 py-3 font-semibold border border-slate-200">How it works</a>
            </div>
        </div>
        <div class="bg-white rounded-2xl p-5 shadow-soft border border-slate-100">
            <div class="carousel-container">
                <div class="carousel-track">
                    <div class="carousel-slide" style="background-image: url('/images/Ceiling_Fan_Installation.png')"></div>
                    <div class="carousel-slide" style="background-image: url('/images/Mounting_TV.png')"></div>
                    <div class="carousel-slide" style="background-image: url('/images/Assembling_Furniture.png')"></div>
                    <div class="carousel-slide" style="background-image: url('/images/Installing_Blinds.png')"></div>
                    <div class="carousel-slide" style="background-image: url('/images/Installing_Faucet.png')"></div>
                    <div class="carousel-slide" style="background-image: url('/images/Smart_Doorbell_Installation.png')"></div>
                    <div class="carousel-slide" style="background-image: url('/images/Closet_Organizer_Installation.png')"></div>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="py-10 border-t border-slate-100 bg-white" id="tasks">
    <div class="max-w-6xl mx-auto px-4">
        <h2 class="text-2xl md:text-3xl font-bold">Popular fixed-price tasks</h2>
        <p class="text-slate-600 mt-2">Click any service to see what's included, then proceed to booking.</p>
        <div class="mt-6 space-y-4">
            <div class="service-card bg-white border border-slate-200 rounded-xl overflow-hidden cursor-pointer hover:border-indigo-300 transition-colors" data-task="tv_mount">
                <div class="service-header p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold text-lg">📺 TV Wall Mount (32–65")</h3>
                            <p class="text-sm text-slate-600">~2.0 hr base • Starting at $160</p>
                        </div>
                        <div class="expand-icon text-slate-400 transform transition-transform">▼</div>
                    </div>
                </div>
                <div class="service-details hidden border-t border-slate-100">
                    <div class="p-4">
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-semibold text-green-600 mb-2">✅ Included:</h4>
                                <ul class="text-sm space-y-1 text-slate-700">
                                    <li>• Mounting TV (32–65") on drywall with wood studs</li>
                                    <li>• Using customer-supplied mount</li>
                                    <li>• Cord cover (if provided)</li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="font-semibold text-orange-600 mb-2">⚠️ Potential Add-ons:</h4>
                                <ul class="text-sm space-y-1 text-slate-700">
                                    <li>• +$40: Mounting on brick, concrete, or over fireplace</li>
                                    <li>• +$25: TVs larger than 65"</li>
                                    <li>• New outlet/electrical work not included</li>
                                </ul>
                            </div>
                        </div>
                        <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                            <p class="text-sm text-blue-700">Click to select this service and answer specific questions in the booking form.</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="service-card bg-white border border-slate-200 rounded-xl overflow-hidden cursor-pointer hover:border-indigo-300 transition-colors" data-task="ceiling_fan">
                <div class="service-header p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold text-lg">💡 Ceiling Fan Install/Replace</h3>
                            <p class="text-sm text-slate-600">~2.5 hr base • Starting at $200</p>
                        </div>
                        <div class="expand-icon text-slate-400 transform transition-transform">▼</div>
                    </div>
                </div>
                <div class="service-details hidden border-t border-slate-100">
                    <div class="p-4">
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-semibold text-green-600 mb-2">✅ Included:</h4>
                                <ul class="text-sm space-y-1 text-slate-700">
                                    <li>• Replacing existing fan or light fixture</li>
                                    <li>• Using existing wiring and fan-rated box</li>
                                    <li>• Assembling blades/light kit</li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="font-semibold text-orange-600 mb-2">⚠️ Potential Add-ons:</h4>
                                <ul class="text-sm space-y-1 text-slate-700">
                                    <li>• +$50: No fan-rated box (requires replacement)</li>
                                    <li>• +$40: Ceilings higher than 10 ft</li>
                                    <li>• New wiring or switches not included</li>
                                </ul>
                            </div>
                        </div>
                        <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                            <p class="text-sm text-blue-700">Click to select this service and answer specific questions in the booking form.</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="service-card bg-white border border-slate-200 rounded-xl overflow-hidden cursor-pointer hover:border-indigo-300 transition-colors" data-task="light_fixture">
                <div class="service-header p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold text-lg">✨ Light Fixture / Chandelier Swap</h3>
                            <p class="text-sm text-slate-600">~1.5 hr base • Starting at $120</p>
                        </div>
                        <div class="expand-icon text-slate-400 transform transition-transform">▼</div>
                    </div>
                </div>
                <div class="service-details hidden border-t border-slate-100">
                    <div class="p-4">
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-semibold text-green-600 mb-2">✅ Included:</h4>
                                <ul class="text-sm space-y-1 text-slate-700">
                                    <li>• Remove old fixture, install new</li>
                                    <li>• Connect to existing wiring</li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="font-semibold text-orange-600 mb-2">⚠️ Potential Add-ons:</h4>
                                <ul class="text-sm space-y-1 text-slate-700">
                                    <li>• +$40: Chandeliers over 25 lbs</li>
                                    <li>• +$30: Ceiling over 10 ft</li>
                                    <li>• Structural bracing or rewiring not included</li>
                                </ul>
                            </div>
                        </div>
                        <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                            <p class="text-sm text-blue-700">Click to select this service and answer specific questions in the booking form.</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="service-card bg-white border border-slate-200 rounded-xl overflow-hidden cursor-pointer hover:border-indigo-300 transition-colors" data-task="faucet_showerhead">
                <div class="service-header p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold text-lg">🚰 Faucet / Showerhead Replace</h3>
                            <p class="text-sm text-slate-600">~1.5 hr base • Starting at $120</p>
                        </div>
                        <div class="expand-icon text-slate-400 transform transition-transform">▼</div>
                    </div>
                </div>
                <div class="service-details hidden border-t border-slate-100">
                    <div class="p-4">
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-semibold text-green-600 mb-2">✅ Included:</h4>
                                <ul class="text-sm space-y-1 text-slate-700">
                                    <li>• Remove old fixture and install new</li>
                                    <li>• Connect to existing plumbing</li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="font-semibold text-orange-600 mb-2">⚠️ Potential Add-ons:</h4>
                                <ul class="text-sm space-y-1 text-slate-700">
                                    <li>• +$40: Corroded plumbing requiring extra work</li>
                                    <li>• +$30: Removing sink/vanity for access</li>
                                    <li>• Leak repairs not included</li>
                                </ul>
                            </div>
                        </div>
                        <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                            <p class="text-sm text-blue-700">Click to select this service and answer specific questions in the booking form.</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="service-card bg-white border border-slate-200 rounded-xl overflow-hidden cursor-pointer hover:border-indigo-300 transition-colors" data-task="smart_doorbell">
                <div class="service-header p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold text-lg">🔔 Smart Doorbell Install</h3>
                            <p class="text-sm text-slate-600">~1.25 hr base • Starting at $100</p>
                        </div>
                        <div class="expand-icon text-slate-400 transform transition-transform">▼</div>
                    </div>
                </div>
                <div class="service-details hidden border-t border-slate-100">
                    <div class="p-4">
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-semibold text-green-600 mb-2">✅ Included:</h4>
                                <ul class="text-sm space-y-1 text-slate-700">
                                    <li>• Replace old doorbell or install wireless unit</li>
                                    <li>• Connect to existing wiring or Wi-Fi</li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="font-semibold text-orange-600 mb-2">⚠️ Potential Add-ons:</h4>
                                <ul class="text-sm space-y-1 text-slate-700">
                                    <li>• +$30: No wiring, drilling required</li>
                                    <li>• +$40: Chime module/transformer replacement</li>
                                    <li>• Complex rewiring not included</li>
                                </ul>
                            </div>
                        </div>
                        <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                            <p class="text-sm text-blue-700">Click to select this service and answer specific questions in the booking form.</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="service-card bg-white border border-slate-200 rounded-xl overflow-hidden cursor-pointer hover:border-indigo-300 transition-colors" data-task="curtains_blinds">
                <div class="service-header p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold text-lg">🪟 Curtain Rods / Blinds</h3>
                            <p class="text-sm text-slate-600">~1.5 hr base • Starting at $120</p>
                        </div>
                        <div class="expand-icon text-slate-400 transform transition-transform">▼</div>
                    </div>
                </div>
                <div class="service-details hidden border-t border-slate-100">
                    <div class="p-4">
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-semibold text-green-600 mb-2">✅ Included:</h4>
                                <ul class="text-sm space-y-1 text-slate-700">
                                    <li>• Install up to 2 rods OR 2 blinds</li>
                                    <li>• Mount to drywall with anchors</li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="font-semibold text-orange-600 mb-2">⚠️ Potential Add-ons:</h4>
                                <ul class="text-sm space-y-1 text-slate-700">
                                    <li>• +$20: Each extra rod/blind beyond 2</li>
                                    <li>• +$40: Mounting on brick, tile, or concrete</li>
                                    <li>• Custom carpentry not included</li>
                                </ul>
                            </div>
                        </div>
                        <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                            <p class="text-sm text-blue-700">Click to select this service and answer specific questions in the booking form.</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="service-card bg-white border border-slate-200 rounded-xl overflow-hidden cursor-pointer hover:border-indigo-300 transition-colors" data-task="floating_shelf">
                <div class="service-header p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold text-lg">📚 Floating Shelf Install</h3>
                            <p class="text-sm text-slate-600">~1.5 hr base • Starting at $120</p>
                        </div>
                        <div class="expand-icon text-slate-400 transform transition-transform">▼</div>
                    </div>
                </div>
                <div class="service-details hidden border-t border-slate-100">
                    <div class="p-4">
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-semibold text-green-600 mb-2">✅ Included:</h4>
                                <ul class="text-sm space-y-1 text-slate-700">
                                    <li>• Install up to 2 shelves</li>
                                    <li>• Standard drywall mounting with anchors</li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="font-semibold text-orange-600 mb-2">⚠️ Potential Add-ons:</h4>
                                <ul class="text-sm space-y-1 text-slate-700">
                                    <li>• +$20: Each extra shelf beyond 2</li>
                                    <li>• +$30: Shelves over 25 lbs or heavy-duty models</li>
                                    <li>• Masonry/tile installs not included</li>
                                </ul>
                            </div>
                        </div>
                        <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                            <p class="text-sm text-blue-700">Click to select this service and answer specific questions in the booking form.</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="service-card bg-white border border-slate-200 rounded-xl overflow-hidden cursor-pointer hover:border-indigo-300 transition-colors" data-task="appliance_hookup">
                <div class="service-header p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold text-lg">⚡ Appliance Hookup (W/D/DW)</h3>
                            <p class="text-sm text-slate-600">~2.0 hr base • Starting at $160</p>
                        </div>
                        <div class="expand-icon text-slate-400 transform transition-transform">▼</div>
                    </div>
                </div>
                <div class="service-details hidden border-t border-slate-100">
                    <div class="p-4">
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-semibold text-green-600 mb-2">✅ Included:</h4>
                                <ul class="text-sm space-y-1 text-slate-700">
                                    <li>• Connect new appliance to existing hookups</li>
                                    <li>• Level and test basic function</li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="font-semibold text-orange-600 mb-2">⚠️ Potential Add-ons:</h4>
                                <ul class="text-sm space-y-1 text-slate-700">
                                    <li>• +$40: Old appliance removal/disposal</li>
                                    <li>• +$30: New vent or supply line required</li>
                                    <li>• Plumbing/electrical modifications not included</li>
                                </ul>
                            </div>
                        </div>
                        <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                            <p class="text-sm text-blue-700">Click to select this service and answer specific questions in the booking form.</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="service-card bg-white border border-slate-200 rounded-xl overflow-hidden cursor-pointer hover:border-indigo-300 transition-colors" data-task="furniture_assembly">
                <div class="service-header p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold text-lg">🪑 Furniture Assembly (S–M)</h3>
                            <p class="text-sm text-slate-600">~2.0 hr base • Starting at $160</p>
                        </div>
                        <div class="expand-icon text-slate-400 transform transition-transform">▼</div>
                    </div>
                </div>
                <div class="service-details hidden border-t border-slate-100">
                    <div class="p-4">
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-semibold text-green-600 mb-2">✅ Included:</h4>
                                <ul class="text-sm space-y-1 text-slate-700">
                                    <li>• Assembly of 1 major item or 2–3 small items</li>
                                    <li>• Standard flat-pack furniture</li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="font-semibold text-orange-600 mb-2">⚠️ Potential Add-ons:</h4>
                                <ul class="text-sm space-y-1 text-slate-700">
                                    <li>• +$30: Large/complex pieces (beds, wardrobes, sectionals)</li>
                                    <li>• +$20 per extra small item</li>
                                    <li>• Wall anchoring not included unless specified</li>
                                </ul>
                            </div>
                        </div>
                        <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                            <p class="text-sm text-blue-700">Click to select this service and answer specific questions in the booking form.</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="service-card bg-white border border-slate-200 rounded-xl overflow-hidden cursor-pointer hover:border-indigo-300 transition-colors" data-task="closet_organizer">
                <div class="service-header p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold text-lg">👕 Closet Organizer Install</h3>
                            <p class="text-sm text-slate-600">~2.5 hr base • Starting at $200</p>
                        </div>
                        <div class="expand-icon text-slate-400 transform transition-transform">▼</div>
                    </div>
                </div>
                <div class="service-details hidden border-t border-slate-100">
                    <div class="p-4">
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-semibold text-green-600 mb-2">✅ Included:</h4>
                                <ul class="text-sm space-y-1 text-slate-700">
                                    <li>• Install standard closet kit (customer-supplied)</li>
                                    <li>• Mount to drywall with included hardware</li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="font-semibold text-orange-600 mb-2">⚠️ Potential Add-ons:</h4>
                                <ul class="text-sm space-y-1 text-slate-700">
                                    <li>• +$50: Cutting/custom fitting required</li>
                                    <li>• +$40: Masonry or non-standard walls</li>
                                    <li>• Electrical/lighting not included</li>
                                </ul>
                            </div>
                        </div>
                        <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                            <p class="text-sm text-blue-700">Click to select this service and answer specific questions in the booking form.</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="service-card bg-white border border-slate-200 rounded-xl overflow-hidden cursor-pointer hover:border-indigo-300 transition-colors" data-task="general_handyman">
                <div class="service-header p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold text-lg">🔧 General Handyman (3+ hours)</h3>
                            <p class="text-sm text-slate-600">~3 hr minimum • Starting at $240</p>
                        </div>
                        <div class="expand-icon text-slate-400 transform transition-transform">▼</div>
                    </div>
                </div>
                <div class="service-details hidden border-t border-slate-100">
                    <div class="p-4">
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-semibold text-green-600 mb-2">✅ Included:</h4>
                                <ul class="text-sm space-y-1 text-slate-700">
                                    <li>• 3-hour minimum for general repairs & tasks</li>
                                    <li>• Basic tools and hardware</li>
                                    <li>• Multiple small tasks or one larger project</li>
                                    <li>• Troubleshooting and problem-solving</li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="font-semibold text-orange-600 mb-2">⚠️ Add-on Options:</h4>
                                <ul class="text-sm space-y-1 text-slate-700">
                                    <li>• +$180: Additional 3-hour block (discounted rate)</li>
                                    <li>• +$360: Two additional 3-hour blocks (6 hours total)</li>
                                    <li>• Materials and parts charged separately</li>
                                    <li>• Specialized trades (plumbing/electrical) not included</li>
                                </ul>
                            </div>
                        </div>
                        <div class="mt-4 p-3 bg-amber-50 border border-amber-200 rounded-lg">
                            <p class="text-sm text-amber-700"><strong>Perfect for:</strong> Touch-up painting, caulking, door adjustments, squeaky hinges, loose handles, weatherstripping, minor drywall repairs, picture hanging, shelf brackets, cabinet adjustments, and other miscellaneous tasks.</p>
                        </div>
                        <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                            <p class="text-sm text-blue-700">Click to select this service and specify your tasks in the booking form.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="mt-8 bg-slate-50 border border-slate-200 rounded-xl p-6">
            <h3 class="font-semibold text-lg mb-3">🔑 Standard Policy for All Tasks</h3>
            <div class="grid md:grid-cols-2 gap-4 text-sm text-slate-700">
                <ul class="space-y-2">
                    <li>• Flat-rate pricing covers base scope</li>
                    <li>• Add-ons are always quoted and approved before work begins</li>
                </ul>
                <ul class="space-y-2">
                    <li>• Cancel anytime before work starts — no charge</li>
                    <li>• Customer must supply fixtures, furniture, appliances, and hardware</li>
                </ul>
            </div>
        </div>
    </div>
</section>

<section id="how" class="py-12">
    <div class="max-w-6xl mx-auto px-4">
        <h2 class="text-2xl md:text-3xl font-bold">How it works</h2>
        <div class="mt-6 grid md:grid-cols-4 gap-6">
            <div class="bg-white rounded-xl p-5 shadow-soft border border-slate-100"><div class="font-semibold">1) Tell us what you need</div><p class="text-sm text-slate-600 mt-1">Pick a task, add notes, and upload 2–5 photos.</p></div>
            <div class="bg-white rounded-xl p-5 shadow-soft border border-slate-100"><div class="font-semibold">2) Instant AI estimate</div><p class="text-sm text-slate-600 mt-1">We analyze your photos to estimate time, parts, and price.</p></div>
            <div class="bg-white rounded-xl p-5 shadow-soft border border-slate-100"><div class="font-semibold">3) Reserve with card</div><p class="text-sm text-slate-600 mt-1">Same-day & evening premiums shown upfront.</p></div>
            <div class="bg-white rounded-xl p-5 shadow-soft border border-slate-100"><div class="font-semibold">4) We dispatch a pro</div><p class="text-sm text-slate-600 mt-1">Nearest qualified tech with AI job sheet.</p></div>
        </div>
    </div>
</section>

<section id="book" class="py-12">
    <div class="max-w-6xl mx-auto px-4 grid md:grid-cols-2 gap-10 items-start">
        <div class="bg-white rounded-2xl p-6 shadow-soft border border-slate-100">
            <h3 class="text-xl font-bold">Start your request</h3>
            <p class="text-sm text-slate-600 mt-1">We'll analyze your photos and show pricing options before you pay.</p>
            <div class="mt-4 grid md:grid-cols-2 gap-4">
                <div><label class="text-sm font-semibold">Full name</label><input id="customerName" required class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2" /></div>
                <div><label class="text-sm font-semibold">Mobile phone</label><input id="customerPhone" required class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2" /></div>
                <div><label class="text-sm font-semibold">Email</label><input type="email" id="customerEmail" required class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2" /></div>
                <div><label class="text-sm font-semibold">ZIP code</label><input id="customerZip" required class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2" /></div>
            </div>
            <div class="mt-4"><label class="text-sm font-semibold">Address (optional)</label><input id="customerAddress" class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2" /></div>
            <div class="mt-4 grid md:grid-cols-2 gap-4">
                <div>
                    <label class="text-sm font-semibold">Task</label>
                    <select id="taskCategory" required class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2">
                        <option value="">Select a task…</option>
                        <option value="tv_mount">TV mounting</option>
                        <option value="ceiling_fan">Ceiling fan install</option>
                        <option value="light_fixture">Light fixture / chandelier swap</option>
                        <option value="faucet_showerhead">Faucet / showerhead replace</option>
                        <option value="smart_doorbell">Smart doorbell install</option>
                        <option value="curtains_blinds">Curtain rods / blinds</option>
                        <option value="floating_shelf">Floating shelf install</option>
                        <option value="appliance_hookup">Appliance hookup (W/D/DW)</option>
                        <option value="furniture_assembly">Furniture assembly (small–medium)</option>
                        <option value="closet_organizer">Closet organizer install</option>
                        <option value="general_handyman">General handyman (3+ hours)</option>
                    </select>
                </div>
                <div>
                    <label class="text-sm font-semibold">Preferred timing</label>
                    <select id="taskWindow" required class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2">
                        <option value="flexible">I'm flexible (best value)</option>
                    </select>
                </div>
            </div>
            <div class="mt-4">
                <label class="text-sm font-semibold">Or select a future week date (up to 2 weeks) - 15% discount!</label>
                <input type="date" id="futureDate" class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2" />
                <div class="mt-2 p-2 bg-blue-50 border border-blue-200 rounded text-xs text-blue-800">
                    <div class="font-semibold mb-1">📅 Booking Calendar Rules:</div>
                    <div class="grid grid-cols-1 gap-1">
                        <div>✅ <strong>Mon-Fri:</strong> All time slots available with 15% discount</div>
                        <div>⚠️ <strong>Saturday:</strong> Only 8AM-12PM available with 30% premium (no discount)</div>
                        <div>🚫 <strong>Sunday:</strong> Not available (will be blocked if attempted)</div>
                    </div>
                </div>
            </div>
            <div id="taskQuestions" class="mt-4 hidden">
                <div class="p-4 bg-blue-50 border border-blue-200 rounded-lg">
                    <h4 class="font-semibold text-blue-800 mb-3">📋 Quick questions about your specific task</h4>
                    <div id="questionsContainer" class="space-y-3"></div>
                </div>
            </div>
            <div class="mt-4">
                <label class="text-sm font-semibold">Describe the job</label>
                <textarea id="taskDescription" rows="3" placeholder="Product link/model, wall/ceiling type, special notes…" class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2"></textarea>
            </div>
            <div class="mt-4">
                <label class="text-sm font-semibold">Upload photos (2–5)</label>
                <input id="taskPhotos" type="file" accept="image/*" multiple class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2" />
                <div id="photoThumbs" class="mt-2 flex flex-wrap gap-2"></div>
            </div>
            <div class="mt-6 flex items-center gap-2">
                <input id="rushOption" type="checkbox" class="h-4 w-4" />
                <label for="rushOption" class="text-sm">Optional rush (+10%)</label>
            </div>
            <div class="mt-4 p-3 bg-amber-50 border border-amber-200 rounded-lg">
                <p class="text-sm text-amber-800">
                    <strong>⚠️ Important:</strong> The final price may include additional charges if site conditions differ from what's described above (e.g., non-standard materials, unexpected complications, etc.). Your technician will always get approval before performing any add-on work.
                </p>
            </div>
            <div class="mt-6">
                <button type="button" id="getEstimateBtn" class="relative w-full overflow-hidden rounded-xl bg-slate-900 text-white px-5 py-3 font-semibold transition-all disabled:opacity-75">
                    <div id="progressBg" class="absolute inset-0 bg-gradient-to-r from-indigo-600 to-purple-600 transform -translate-x-full transition-transform duration-3000 ease-out"></div>
                    <span id="estimateText" class="relative z-10">🔧 Get pricing options</span>
                </button>
                <div id="progressContainer" class="mt-3 hidden">
                    <div class="w-full bg-slate-200 rounded-full h-2">
                        <div id="progressBar" class="bg-gradient-to-r from-blue-500 to-indigo-600 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                    </div>
                    <div id="progressMessage" class="text-sm text-slate-600 mt-1 text-center">Starting analysis...</div>
                </div>
            </div>
        </div>
        <aside id="estimatePanel" class="bg-white rounded-2xl p-6 shadow-soft border border-slate-100 hidden">
            <h3 class="text-xl font-bold">Choose your timing & price</h3>
            <p class="text-sm text-slate-600 mb-2">Select your preferred option. All prices include everything.</p>
            <div id="flexibleNotice" class="hidden mb-4 p-3 bg-green-50 border border-green-200 rounded-lg">
                <p class="text-sm text-green-700">
                    💡 <strong>Great choice!</strong> You selected "I'm flexible" so we've automatically found the best value timing for you.
                </p>
            </div>
            <div id="pricingOptions" class="space-y-4 mb-6"></div>
            <div class="mt-4">
                <h4 class="font-semibold">What we'll do</h4>
                <ul id="estimateScope" class="list-disc pl-5 text-sm text-slate-700 space-y-1"></ul>
            </div>
            <div class="mt-4">
                <h4 class="font-semibold">Things to note</h4>
                <ul id="estimateRisks" class="list-disc pl-5 text-sm text-slate-700 space-y-1"></ul>
            </div>
            <div class="mt-6">
                <button id="reserveBtn" class="w-full rounded-xl bg-indigo-600 text-white px-5 py-3 font-semibold shadow-soft disabled:opacity-50" disabled>💳 Reserve with card</button>
            </div>
            <p class="mt-3 text-xs text-slate-500">If site conditions differ, your tech will confirm any changes before work begins.</p>
        </aside>
    </div>
</section>

<div id="paymentModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl p-6 max-w-md w-full shadow-2xl max-h-[90vh] overflow-y-auto">
        <div class="flex items-center justify-between mb-4">
            <h3 class="text-xl font-bold">Complete Payment</h3>
            <button id="closePayment" class="text-slate-400 hover:text-slate-600 text-2xl">&times;</button>
        </div>
        <div class="mb-4 p-3 bg-slate-50 rounded-lg">
            <div class="text-sm text-slate-600">Total amount</div>
            <div id="paymentAmount" class="text-2xl font-bold">$0</div>
            <div class="text-sm text-slate-600 mt-1">
                <span id="paymentTiming">Selected timing</span>
            </div>
        </div>
        <form id="paymentForm">
            <div id="stripe-payment-element" class="mb-4"></div>
            <button id="submitPayment" type="submit" class="w-full rounded-xl bg-indigo-600 text-white px-5 py-3 font-semibold disabled:opacity-50 transition-all">
                <span id="paymentButtonText">Complete Payment</span>
            </button>
            <div id="paymentMessage" class="mt-4 text-sm hidden"></div>
        </form>
    </div>
</div>

<div id="taskInfoModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl p-6 max-w-lg w-full shadow-2xl max-h-[90vh] overflow-y-auto">
        <div class="text-center mb-6">
            <div class="text-6xl mb-2">✅</div>
            <h3 class="text-xl font-bold mb-2 text-green-600">Payment Approved!</h3>
            <div class="bg-green-50 border border-green-200 rounded-lg p-3 mb-4">
                <p class="text-sm text-green-700">Your payment was processed successfully. Please provide additional details below to dispatch your handyman.</p>
            </div>
        </div>
        <form id="taskInfoForm">
            <div class="bg-slate-50 rounded-lg p-4 mb-6">
                <h4 class="font-semibold mb-3">Job Summary (from your request)</h4>
                <div class="text-sm space-y-1">
                    <div><strong>Task ID:</strong> <span id="summaryTaskId" class="font-mono text-indigo-600">—</span></div>
                    <div><strong>Customer:</strong> <span id="summaryName">—</span></div>
                    <div><strong>Phone:</strong> <span id="summaryPhone">—</span></div>
                    <div><strong>Email:</strong> <span id="summaryEmail">—</span></div>
                    <div><strong>Task:</strong> <span id="summaryTask">—</span></div>
                    <div><strong>Window:</strong> <span id="summaryWindow">—</span></div>
                    <div><strong>Description:</strong> <span id="summaryDescription">—</span></div>
                    <div class="pt-2 mt-2 border-t border-slate-200">
                        <strong>Amount Paid:</strong> <span id="summaryAmount" class="text-green-600 font-bold text-lg">—</span>
                    </div>
                </div>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="text-sm font-semibold text-gray-700">Complete Property Address *</label>
                    <textarea id="propertyAddress" rows="3" placeholder="123 Main St, Unit 2B, Boca Raton, FL 33432" required class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2 focus:ring-2 focus:ring-indigo-500"></textarea>
                    <p class="text-xs text-slate-500 mt-1">Include street number, name, city, and ZIP code</p>
                </div>
                <div>
                    <label class="text-sm font-semibold text-gray-700">Best Contact Phone *</label>
                    <input type="tel" id="contactPhone" required class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2 focus:ring-2 focus:ring-indigo-500" />
                </div>
                <div>
                    <label class="text-sm font-semibold text-gray-700">Property Access Details</label>
                    <textarea id="accessDetails" rows="3" placeholder="Gate code: 1234, Park in visitor spots, Ring doorbell..." class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2 focus:ring-2 focus:ring-indigo-500"></textarea>
                </div>
                <div>
                    <label class="text-sm font-semibold text-gray-700">Pets & Special Considerations</label>
                    <textarea id="petsAndSpecial" rows="2" placeholder="2 friendly dogs, alarm system code needed, delicate antiques nearby..." class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2 focus:ring-2 focus:ring-indigo-500"></textarea>
                </div>
                <div>
                    <label class="text-sm font-semibold text-gray-700">Additional Task Details</label>
                    <textarea id="additionalDetails" rows="3" placeholder="TV model: Samsung 65", wall type: drywall, tools available on site..." class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2 focus:ring-2 focus:ring-indigo-500"></textarea>
                </div>
            </div>
            <div class="mt-6">
                <button type="submit" class="w-full rounded-xl bg-indigo-600 text-white px-5 py-3 font-semibold hover:bg-indigo-700 transition-colors">
                    🚀 Dispatch Handyman
                </button>
            </div>
        </form>
    </div>
</div>

<div id="finalSuccessModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl p-6 max-w-md w-full shadow-2xl text-center">
        <div class="text-6xl mb-4">🚀</div>
        <h3 class="text-xl font-bold mb-2 text-green-600">Handyman Dispatched!</h3>
        <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-4">
            <p class="text-sm text-green-700 mb-2">
                <strong>✅ Payment processed</strong><br>
                <strong>✅ Job details sent to our team</strong><br>
                <strong>✅ Notification sent to handyman dispatch</strong>
            </p>
            <div class="mt-3 p-2 bg-white rounded border">
                <div class="text-xs text-slate-500">Your Task ID</div>
                <div id="finalTaskId" class="font-mono text-sm font-semibold text-indigo-600">—</div>
            </div>
            <div class="mt-3 p-2 bg-white rounded border">
                <div class="text-xs text-slate-500">Amount Paid</div>
                <div id="finalPaidAmount" class="text-lg font-bold text-green-600">—</div>
            </div>
            <p class="text-sm text-slate-600 mt-2">
                You'll receive a text message with your technician's details and estimated arrival time within the next 15 minutes.
            </p>
        </div>
        <button id="closeFinalSuccess" class="rounded-xl bg-indigo-600 text-white px-5 py-3 font-semibold hover:bg-indigo-700 transition-colors">Perfect!</button>
    </div>
</div>

<section id="coverage" class="py-12 bg-white border-t border-b border-slate-100">
    <div class="max-w-6xl mx-auto px-4">
        <h2 class="text-2xl md:text-3xl font-bold">Coverage areas</h2>
        <p class="mt-2 text-slate-600">Palm Beach • Boca Raton • Delray Beach • Boynton Beach • Fort Lauderdale • Hollywood • Aventura • Miami • Coral Gables • Kendall</p>
    </div>
</section>

<section id="faq" class="py-12">
    <div class="max-w-6xl mx-auto px-4 grid md:grid-cols-2 gap-8">
        <div><h3 class="text-xl font-bold">Is this a marketplace?</h3><p class="text-slate-600 mt-1">We're a vetted dispatch service. We send a qualified pro and back the work with standardized checklists and guidance.</p></div>
        <div><h3 class="text-xl font-bold">How do premiums work?</h3><p class="text-slate-600 mt-1">Like airline pricing, same-day and evening windows include a clear premium. It's shown before you pay.</p></div>
        <div><h3 class="text-xl font-bold">Do you charge before the job?</h3><p class="text-slate-600 mt-1">We place an authorization to secure your time. You're only charged after the tech confirms scope on site.</p></div>
        <div><h3 class="text-xl font-bold">Are pros background-checked?</h3><p class="text-slate-600 mt-1">Yes. We verify ID, experience, and insurance where applicable.</p></div>
    </div>
</section>

<div id="chatbot-container" class="fixed bottom-4 right-4 z-50">
    <button id="chatbot-toggle" class="relative">
        <div class="chatbot-notification">!</div>
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
        </svg>
    </button>
    <div id="chatbot-window" class="hidden absolute bottom-16 right-0 bg-white rounded-lg shadow-2xl border border-slate-200 flex flex-col">
        <div class="bg-indigo-600 text-white p-4 rounded-t-lg flex items-center justify-between">
            <div>
                <h3 class="font-semibold">SendAHandyman Help</h3>
                <p class="text-sm text-indigo-100">Ask me about our services!</p>
            </div>
            <button id="chatbot-close" class="text-indigo-100 hover:text-white">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>
        <div id="chatbot-messages" class="flex-1 p-4 overflow-y-auto space-y-3">
            <div class="flex items-start space-x-2">
                <div class="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center flex-shrink-0">
                    <svg class="w-4 h-4 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                    </svg>
                </div>
                <div class="bg-slate-100 rounded-lg p-3 max-w-xs">
                    <p class="text-sm text-slate-700">Hi! I'm here to help with questions about our handyman services. What can I help you with today?</p>
                </div>
            </div>
        </div>
        <div class="border-t border-slate-200 p-4">
            <div class="flex space-x-2">
                <input type="text" id="chatbot-input" placeholder="Type your question..." class="flex-1 border border-slate-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500" maxlength="500" />
                <button id="chatbot-send" class="bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg px-4 py-2 text-sm font-semibold transition-colors disabled:opacity-50 disabled:cursor-not-allowed">Send</button>
            </div>
        </div>
    </div>
</div>

<footer class="py-10 border-t border-slate-100 text-sm text-slate-600">
    <div class="max-w-6xl mx-auto px-4 flex flex-col md:flex-row items-center justify-between gap-3">
        <div class="flex items-center gap-2">
            <img src="/images/helpinghands_logo.png" alt="Helping Hands Logo" class="h-8 w-auto">
            <span>© <span id="year"></span> SendAHandyman v <span id="version"></span></span>
        </div>
        <div class="flex items-center gap-4">
            <a href="privacy.html" class="hover:text-slate-900">Privacy</a>
            <a href="terms.html" class="hover:text-slate-900">Terms</a>
            <a href="mailto:info@sendahandyman.com" class="hover:text-slate-900">Contact</a>
        </div>
    </div>
</footer>

<script>
    console.log('📜 JavaScript started loading...');
    const ZAPIER_CONFIG = {
        WEBHOOK_URL: 'https://hooks.zapier.com/hooks/catch/24412806/uh8lvew/',
        ENABLED: true
    };
    let formData = {};
    let estimateData = {};
    let selectedPricingOption = null;
    let paymentIntentId = null;
    let paymentElementReady = false;
    const APP_VERSION = "2.0.5";
    const STRIPE_PUBLISHABLE_KEY = 'pk_test_51Rz41zHQ4TkcNcqvEebLo8rN5MmgInckOQSG6tuZa4XoN6czEXbxK8FtXcJqEu9RbkHclHxRhXRHVRAxDJ2q6PtD00KbGASb91';
    let stripe, elements, paymentElement;
    const RATE = 80;
    const PREMIUM_CURRENT_BLOCK = 0.30;
    const PREMIUM_NEXT_BLOCK = 0.20;
    const PREMIUM_EVENING_BLOCK = 0.35;
    const PREMIUM_RUSH = 0.10;
    const DISCOUNT_FUTURE = 0.15;
    const PREMIUM_SATURDAY = 0.30;
    const TIME_WINDOWS = {
        today_am: { label: "Today (8AM-12PM)", start: 8, end: 12 },
        today_pm: { label: "Today (12PM-4PM)", start: 12, end: 16 },
        today_eve: { label: "Today (4PM-8PM)", start: 16, end: 20 },
        tomorrow_am: { label: "Tomorrow (8AM-12PM)", start: 8, end: 12 },
        tomorrow_pm: { label: "Tomorrow (12PM-4PM)", start: 12, end: 16 },
        tomorrow_eve: { label: "Tomorrow (4PM-8PM)", start: 16, end: 20 },
        monday_am: { label: "Monday (8AM-12PM)", start: 8, end: 12 },
        monday_pm: { label: "Monday (12PM-4PM)", start: 12, end: 16 },
        monday_eve: { label: "Monday (4PM-8PM)", start: 16, end: 20 }
    };

    function isSunday(date) {
        return date.getDay() === 0;
    }

    function isSaturday(date) {
        return date.getDay() === 6;
    }

    function getNextAvailableDay(date) {
        const nextDay = new Date(date);
        nextDay.setDate(nextDay.getDate() + 1);
        if (isSunday(nextDay)) {
            nextDay.setDate(nextDay.getDate() + 1);
        }
        return nextDay;
    }

    function getCurrentBlock() {
        const now = new Date();
        const hour = now.getHours();
        if (hour >= 8 && hour < 12) return 'today_am';
        if (hour >= 12 && hour < 16) return 'today_pm';
        if (hour >= 16 && hour < 20) return 'today_eve';
        return null;
    }

    function isBlockInPast(blockKey) {
        const now = new Date();
        const hour = now.getHours();
        if (blockKey === 'today_am' && hour >= 12) return true;
        if (blockKey === 'today_pm' && hour >= 16) return true;
        if (blockKey === 'today_eve' && hour >= 20) return true;
        return false;
    }

    function isTimeWindowAvailable(windowKey) {
        return !isBlockInPast(windowKey);
    }

    function getAvailableTimeWindows() {
        const now = new Date();
        const today = new Date(now);
        const tomorrow = new Date(now);
        tomorrow.setDate(tomorrow.getDate() + 1);
        const isTodaySunday = isSunday(today);
        const isTomorrowSunday = isSunday(tomorrow);
        const isTodaySaturday = isSaturday(today);
        const isTomorrowSaturday = isSaturday(tomorrow);
        const currentHour = now.getHours();
        let available = [];
        if (!isTodaySunday) {
            if (isTodaySaturday) {
                if (currentHour < 12) {
                    available.push('today_am');
                }
            } else {
                if (currentHour < 12) available.push('today_am');
                if (currentHour < 16) available.push('today_pm');
                if (currentHour < 20) available.push('today_eve');
            }
        }
        if (!isTomorrowSunday) {
            if (isTomorrowSaturday) {
                available.push('tomorrow_am');
            } else {
                available.push('tomorrow_am');
                available.push('tomorrow_pm');
                available.push('tomorrow_eve');
            }
        }
        if (isTodaySaturday && currentHour >= 12 && isTomorrowSunday) {
            available.push('monday_am');
            available.push('monday_pm');
            available.push('monday_eve');
        }
        return available;
    }

    const TASKS = {
        tv_mount: {
            hours: 2.0,
            label: "TV Wall Mount (32–65\")",
            questions: [
                {
                    id: 'tv_size',
                    label: 'What size is your TV?',
                    options: [
                        { value: 'standard', label: '32-65 inches', addon: 0 },
                        { value: 'large', label: 'Larger than 65 inches', addon: 25 }
                    ]
                },
                {
                    id: 'wall_type',
                    label: 'What type of wall?',
                    options: [
                        { value: 'drywall', label: 'Drywall with studs', addon: 0 },
                        { value: 'brick', label: 'Brick/concrete', addon: 40 },
                        { value: 'fireplace', label: 'Above fireplace', addon: 40 }
                    ]
                },
                {
                    id: 'mount_owned',
                    label: 'Do you have the wall mount?',
                    options: [
                        { value: 'yes', label: 'Yes, I have it', addon: 0 },
                        { value: 'no', label: 'No, need to purchase', addon: 0 }
                    ]
                }
            ]
        },
        ceiling_fan: {
            hours: 2.5,
            label: "Ceiling Fan Install/Replace",
            questions: [
                {
                    id: 'replacing',
                    label: 'Replacing existing fan or light?',
                    options: [
                        { value: 'fan', label: 'Yes, existing fan', addon: 0 },
                        { value: 'light', label: 'Yes, existing light fixture', addon: 0 },
                        { value: 'new', label: 'New installation', addon: 0 }
                    ]
                },
                {
                    id: 'fan_box',
                    label: 'Is ceiling box fan-rated?',
                    options: [
                        { value: 'yes', label: 'Yes/Don\'t know', addon: 0 },
                        { value: 'no', label: 'No, needs replacement', addon: 50 }
                    ]
                },
                {
                    id: 'ceiling_height',
                    label: 'Ceiling height?',
                    options: [
                        { value: 'standard', label: 'Under 10 feet', addon: 0 },
                        { value: 'high', label: 'Over 10 feet', addon: 40 }
                    ]
                }
            ]
        },
        light_fixture: {
            hours: 1.5,
            label: "Light Fixture / Chandelier Swap",
            questions: [
                {
                    id: 'fixture_type',
                    label: 'Type of fixture?',
                    options: [
                        { value: 'standard', label: 'Standard light fixture', addon: 0 },
                        { value: 'small_chandelier', label: 'Chandelier (under 25 lbs)', addon: 0 },
                        { value: 'heavy_chandelier', label: 'Heavy chandelier (over 25 lbs)', addon: 40 }
                    ]
                },
                {
                    id: 'ceiling_height',
                    label: 'Ceiling height?',
                    options: [
                        { value: 'standard', label: 'Under 10 feet', addon: 0 },
                        { value: 'high', label: 'Over 10 feet', addon: 30 }
                    ]
                }
            ]
        },
        faucet_showerhead: {
            hours: 1.5,
            label: "Faucet / Showerhead Replace",
            questions: [
                {
                    id: 'fixture_type',
                    label: 'What are you replacing?',
                    options: [
                        { value: 'faucet', label: 'Kitchen/bathroom faucet', addon: 0 },
                        { value: 'showerhead', label: 'Showerhead', addon: 0 },
                        { value: 'both', label: 'Both faucet and showerhead', addon: 0 }
                    ]
                },
                {
                    id: 'plumbing_issues',
                    label: 'Any plumbing issues?',
                    options: [
                        { value: 'none', label: 'No issues', addon: 0 },
                        { value: 'corrosion', label: 'Some corrosion/leaks', addon: 40 },
                        { value: 'access', label: 'Need sink removal', addon: 30 }
                    ]
                }
            ]
        },
        smart_doorbell: {
            hours: 1.25,
            label: "Smart Doorbell Install",
            questions: [
                {
                    id: 'install_type',
                    label: 'Installation type?',
                    options: [
                        { value: 'replace', label: 'Replacing existing doorbell', addon: 0 },
                        { value: 'wireless', label: 'New wireless install', addon: 30 }
                    ]
                },
                {
                    id: 'chime_status',
                    label: 'Current doorbell chime working?',
                    options: [
                        { value: 'working', label: 'Yes, works fine', addon: 0 },
                        { value: 'broken', label: 'No/needs replacement', addon: 40 },
                        { value: 'no_chime', label: 'Don\'t want chime connected', addon: 0 }
                    ]
                }
            ]
        },
        curtains_blinds: {
            hours: 1.5,
            label: "Curtain Rods / Blinds",
            questions: [
                {
                    id: 'quantity',
                    label: 'How many rods/blinds?',
                    options: [
                        { value: 'standard', label: '1-2 items (included)', addon: 0 },
                        { value: 'medium', label: '3-4 items', addon: 40 },
                        { value: 'large', label: '5+ items', addon: 80 }
                    ]
                },
                {
                    id: 'wall_type',
                    label: 'What type of wall?',
                    options: [
                        { value: 'drywall', label: 'Drywall', addon: 0 },
                        { value: 'masonry', label: 'Brick/tile/concrete', addon: 40 }
                    ]
                }
            ]
        },
        floating_shelf: {
            hours: 1.5,
            label: "Floating Shelf Install",
            questions: [
                {
                    id: 'quantity',
                    label: 'How many shelves?',
                    options: [
                        { value: 'standard', label: '1-2 shelves (included)', addon: 0 },
                        { value: 'medium', label: '3-4 shelves', addon: 40 },
                        { value: 'large', label: '5+ items', addon: 80 }
                    ]
                },
                {
                    id: 'weight',
                    label: 'Shelf weight/size?',
                    options: [
                        { value: 'standard', label: 'Standard (under 25 lbs)', addon: 0 },
                        { value: 'heavy', label: 'Heavy-duty (over 25 lbs)', addon: 30 }
                    ]
                }
            ]
        },
        appliance_hookup: {
            hours: 2.0,
            label: "Appliance Hookup (W/D/DW)",
            questions: [
                {
                    id: 'appliance_type',
                    label: 'What appliance?',
                    options: [
                        { value: 'washer', label: 'Washer', addon: 0 },
                        { value: 'dryer', label: 'Dryer', addon: 0 },
                        { value: 'dishwasher', label: 'Dishwasher', addon: 0 },
                        { value: 'multiple', label: 'Multiple appliances', addon: 0 }
                    ]
                },
                {
                    id: 'old_removal',
                    label: 'Replacing an old unit?',
                    options: [
                        { value: 'remove', label: 'Yes, remove old', addon: 40 },
                        { value: 'new', label: 'No, new installation', addon: 0 },
                        { value: 'disconnect', label: 'Just disconnecting old', addon: 0 }
                    ]
                },
                {
                    id: 'hookups_ready',
                    label: 'Are hookups ready?',
                    options: [
                        { value: 'ready', label: 'Yes, all connections ready', addon: 0 },
                        { value: 'new_line', label: 'Need new vent/line', addon: 30 },
                        { value: 'unsure', label: 'Not sure', addon: 0 }
                    ]
                }
            ]
        },
        furniture_assembly: {
            hours: 2.0,
            label: "Furniture Assembly (S–M)",
            questions: [
                {
                    id: 'furniture_type',
                    label: 'What type of furniture?',
                    options: [
                        { value: 'standard', label: 'Dresser/desk/table', addon: 0 },
                        { value: 'bed', label: 'Bed frame', addon: 30 },
                        { value: 'wardrobe', label: 'Large wardrobe', addon: 30 },
                        { value: 'multiple', label: 'Multiple small items', addon: 0 }
                    ]
                },
                {
                    id: 'quantity',
                    label: 'How many items?',
                    options: [
                        { value: 'single', label: '1 major item', addon: 0 },
                        { value: 'few', label: '2-3 small items', addon: 0 },
                        { value: 'many', label: '4+ items', addon: 40 }
                    ]
                }
            ]
        },
        closet_organizer: {
            hours: 2.5,
            label: "Closet Organizer Install",
            questions: [
                {
                    id: 'organizer_type',
                    label: 'Type of organizer?',
                    options: [
                        { value: 'standard', label: 'Shelves and rods', addon: 0 },
                        { value: 'modular', label: 'Modular cube system', addon: 0 },
                        { value: 'wire', label: 'Wire rack system', addon: 0 },
                        { value: 'custom', label: 'Custom wood system', addon: 0 }
                    ]
                },
                {
                    id: 'custom_fitting',
                    label: 'Need custom cutting?',
                    options: [
                        { value: 'no', label: 'No, standard sizes', addon: 0 },
                        { value: 'yes', label: 'Yes, custom fitting', addon: 50 },
                        { value: 'unsure', label: 'Not sure', addon: 0 }
                    ]
                },
                {
                    id: 'wall_type',
                    label: 'What type of wall?',
                    options: [
                        { value: 'drywall', label: 'Standard drywall', addon: 0 },
                        { value: 'masonry', label: 'Concrete/masonry', addon: 40 },
                        { value: 'unsure', label: 'Not sure', addon: 0 }
                    ]
                }
            ]
        },
        general_handyman: {
            hours: 3,
            label: "General Handyman (3+ hours)",
            questions: [
                {
                    id: 'task_complexity',
                    label: 'What type of tasks do you need done?',
                    options: [
                        { value: 'basic', label: 'Basic repairs, adjustments, or maintenance', addon: 0 },
                        { value: 'multiple', label: 'Multiple small tasks or repairs', addon: 0 },
                        { value: 'complex', label: 'More complex projects requiring planning', addon: 0 }
                    ]
                },
                {
                    id: 'additional_time',
                    label: 'Do you need additional time beyond 3 hours?',
                    options: [
                        { value: 'none', label: 'No, 3 hours should be sufficient', addon: 0 },
                        { value: 'one_block', label: 'Yes, add 3 more hours', addon: 180 },
                        { value: 'two_blocks', label: 'Yes, add 6 more hours', addon: 360 }
                    ]
                },
                {
                    id: 'materials_needed',
                    label: 'Will materials or parts be needed?',
                    options: [
                        { value: 'customer_supplies', label: 'I will provide all materials', addon: 0 },
                        { value: 'basic_supplies', label: 'May need basic supplies (screws, caulk, etc.)', addon: 0 },
                        { value: 'unsure', label: 'Not sure what will be needed', addon: 0 }
                    ]
                }
            ]
        },
        minor_repairs: { hours: 2.0, label: "Minor repairs", questions: [] }
    };

    function validatePropertyAddress(address) {
        if (!address || address.trim().length < 10) {
            return {
                valid: false,
                message: 'Please enter a complete address (minimum 10 characters)'
            };
        }
        const addressLower = address.toLowerCase();
        const hasNumber = /\d+/.test(address);
        if (!hasNumber) {
            return {
                valid: false,
                message: 'Address must include a street number'
            };
        }
        const floridaCities = ['boca raton', 'delray beach', 'boynton beach', 'fort lauderdale',
                               'hollywood', 'aventura', 'miami', 'coral gables', 'kendall',
                               'palm beach', 'west palm beach', 'pompano'];
        const hasCity = floridaCities.some(city => addressLower.includes(city));
        const hasZip = /\b33\d{3}\b|\b34\d{3}\b/.test(address);
        if (!hasCity && !hasZip) {
            return {
                valid: false,
                message: 'Please include city name or ZIP code (we serve South Florida)'
            };
        }
        const hasStreetType = /(street|st|avenue|ave|road|rd|drive|dr|lane|ln|boulevard|blvd|way|court|ct|circle|cir|place|pl)/i.test(address);
        if (!hasStreetType) {
            return {
                valid: false,
                message: 'Please include street type (St, Ave, Rd, etc.)'
            };
        }
        return { valid: true };
    }

    function debugPricingFlow(step, data) {
        console.log(`🔍 PRICING DEBUG [${step}]:`, {
            selectedOption: selectedPricingOption?.type,
            window: selectedPricingOption?.window,
            amount: selectedPricingOption?.pricing?.total,
            additionalData: data
        });
    }

    function initializeStripe() {
        if (typeof Stripe !== 'undefined') {
            if (!STRIPE_PUBLISHABLE_KEY.includes('YOUR_ACTUAL_STRIPE_KEY_HERE')) {
                try {
                    stripe = Stripe(STRIPE_PUBLISHABLE_KEY);
                    console.log('✅ Stripe initialized successfully');
                } catch (error) {
                    console.error('❌ Stripe initialization failed:', error);
                }
            } else {
                console.error('❌ Please set your actual Stripe publishable key!');
            }
        } else {
            console.log('⏳ Stripe not loaded yet, retrying...');
            setTimeout(initializeStripe, 1000);
        }
    }

    function generateTaskId() {
        const timestamp = Date.now().toString(36);
        const random = Math.random().toString(36).substring(2, 8);
        return `TASK-${timestamp}-${random}`.toUpperCase();
    }

    async function sendSMSNotification(type, data) {
        try {
            console.log(`📱 Sending ${type} SMS notification...`);
            const response = await fetch('/.netlify/functions/send-sms', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    type: type,
                    data: data
                })
            });
            if (response.ok) {
                const result = await response.json();
                console.log(`✅ ${type} SMS sent successfully:`, result.messageSid);
                return { success: true, data: result };
            } else {
                const error = await response.json();
                console.log(`⚠️ SMS ${type} failed:`, error.error);
                return { success: false, error: error.error };
            }
        } catch (error) {
            console.error(`❌ SMS ${type} error:`, error);
            return { success: false, error: error.message };
        }
    }

    async function sendZapierNotification(jobData) {
        if (!ZAPIER_CONFIG.ENABLED || ZAPIER_CONFIG.WEBHOOK_URL.includes('YOUR_ZAPIER_WEBHOOK_ID')) {
            console.log('⚠️ Zapier webhook not configured - skipping notification');
            return { success: false, message: 'Webhook not configured' };
        }
        const zapierData = {
            task_id: jobData.task_id,
            timestamp: new Date().toISOString(),
            customer_name: jobData.name,
            customer_phone: jobData.phone,
            customer_email: jobData.email,
            customer_zip: jobData.zip,
            customer_address: jobData.address || '',
            task_category: jobData.category,
            task_category_label: TASKS[jobData.category]?.label || jobData.category,
            time_window: jobData.window,
            description: jobData.description || 'None provided',
            rush_service: jobData.rush,
            estimated_hours: jobData.estimated_hours,
            base_amount: jobData.base_amount,
            total_amount: jobData.total_amount,
            total_amount_formatted: '$' + jobData.total_amount.toFixed(2),
            premiums_applied: jobData.premiums?.map(p => p.label).join(', ') || 'None',
            property_address: jobData.property_address,
            contact_phone: jobData.contact_phone,
            access_details: jobData.access_details || 'None provided',
            pets_and_special: jobData.pets_and_special || 'None provided',
            additional_details: jobData.additional_details || 'None provided',
            payment_intent_id: jobData.payment_intent_id,
            step_scope: jobData.step_scope?.join(' • ') || 'Standard scope',
            risk_flags: jobData.risk_flags?.join(' • ') || 'No special risks noted',
            notification_email: 'info@sendahandyman.com'
        };
        try {
            console.log('📧 Sending notification via Zapier webhook...');
            const params = new URLSearchParams();
            Object.keys(zapierData).forEach(key => {
                params.append(key, zapierData[key]);
            });
            const response = await fetch(ZAPIER_CONFIG.WEBHOOK_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: params.toString()
            });
            if (response.ok) {
                const result = await response.json();
                console.log('✅ Zapier notification sent successfully:', result);
                return { success: true, data: result };
            } else {
                throw new Error(`Zapier webhook failed: ${response.status} ${response.statusText}`);
            }
        } catch (error) {
            console.error('❌ Zapier notification failed:', error);
            return { success: false, error: error.message };
        }
    }

    function showTaskQuestions(taskKey) {
        const task = TASKS[taskKey];
        const questionsSection = document.getElementById('taskQuestions');
        const questionsContainer = document.getElementById('questionsContainer');
        if (!task || !task.questions || task.questions.length === 0) {
            questionsSection.classList.add('hidden');
            return;
        }
        questionsContainer.innerHTML = '';
        task.questions.forEach(question => {
            const questionDiv = document.createElement('div');
            questionDiv.className = 'space-y-2';
            const label = document.createElement('label');
            label.className = 'block text-sm font-semibold text-slate-700';
            label.textContent = question.label;
            const select = document.createElement('select');
            select.className = 'w-full rounded-lg border border-slate-200 px-3 py-2 text-sm';
            select.id = `question_${question.id}`;
            select.addEventListener('change', updateEstimateWithAddons);
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = 'Please select...';
            select.appendChild(defaultOption);
            question.options.forEach(option => {
                const optionElement = document.createElement('option');
                optionElement.value = option.value;
                optionElement.textContent = option.label + (option.addon > 0 ? ` (+$${option.addon})` : '');
                optionElement.dataset.addon = option.addon;
                select.appendChild(optionElement);
            });
            questionDiv.appendChild(label);
            questionDiv.appendChild(select);
            questionsContainer.appendChild(questionDiv);
        });
        questionsSection.classList.remove('hidden');
    }

    function calculateAddons(taskKey) {
        const task = TASKS[taskKey];
        if (!task || !task.questions) return 0;
        let totalAddons = 0;
        console.log('🔍 Calculating addons for task:', taskKey);
        task.questions.forEach(question => {
            const select = document.getElementById(`question_${question.id}`);
            if (select && select.value) {
                const selectedOption = select.options[select.selectedIndex];
                const addon = parseInt(selectedOption.dataset.addon) || 0;
                console.log(`📊 Question ${question.id}: selected "${select.value}" with addon ${addon}`);
                totalAddons += addon;
            }
        });
        console.log('💰 Total addons calculated:', totalAddons);
        return totalAddons;
    }

    function updateEstimateWithAddons() {
        const taskKey = document.getElementById('taskCategory').value;
        if (!taskKey) return;
        const addons = calculateAddons(taskKey);
        console.log('Current add-ons total:', addons);
    }

    function calculatePricing(hours, window, rush, addons = 0, selectedDate = null) {
        const base = hours * RATE;
        let premiums = [];
        let total = base + addons;
        const currentBlock = getCurrentBlock();
        const isToday = window.startsWith('today');
        const isTomorrow = window.startsWith('tomorrow');
        const isMonday = window.startsWith('monday');
        const isFuture = selectedDate !== null;
        const isEveningBlock = window.includes('eve');
        const now = new Date();
        let bookingDate;
        if (isToday) {
            bookingDate = now;
        } else if (isTomorrow) {
            bookingDate = new Date(now);
            bookingDate.setDate(bookingDate.getDate() + 1);
        } else if (isMonday) {
            bookingDate = new Date(now);
            bookingDate.setDate(bookingDate.getDate() + 2);
        } else if (isFuture && selectedDate) {
            bookingDate = new Date(selectedDate);
        }
        const isBookingSaturday = bookingDate && isSaturday(bookingDate);

        // Debug logging for Saturday pricing
        if (isBookingSaturday && isFuture) {
            console.log('🔍 Saturday Future Booking Detected:', {
                date: bookingDate.toDateString(),
                basePrice: base,
                expectedPremium: base * PREMIUM_SATURDAY,
                shouldNotHaveDiscount: true
            });
        }

        if (isFuture) {
            // CRITICAL: Evening blocks NEVER get discounts - always +35% premium
            if (isEveningBlock) {
                const premium = base * PREMIUM_EVENING_BLOCK;
                premiums.push({ label: 'Evening block premium (4-8PM, +35%)', amount: premium });
                total += premium;
                console.log('🌙 Evening block detected for future date - applying +35% premium (NO discount)');
            }
            // For future bookings, Saturday gets +30% premium INSTEAD of -15% discount
            else if (isBookingSaturday) {
                const satPremium = base * PREMIUM_SATURDAY;
                premiums.push({ label: 'Saturday service premium (+30%)', amount: satPremium });
                total += satPremium;
            } else {
                // Only apply 15% discount for non-Saturday, non-evening future bookings
                const discount = base * DISCOUNT_FUTURE;
                premiums.push({ label: 'Future booking discount (-15%)', amount: -discount });
                total -= discount;
            }
        } else if (isToday) {
            if (isBookingSaturday) {
                const satPremium = base * PREMIUM_SATURDAY;
                premiums.push({ label: 'Saturday service premium (+30%)', amount: satPremium });
                total += satPremium;
            }
            if (isEveningBlock) {
                const premium = base * PREMIUM_EVENING_BLOCK;
                premiums.push({ label: 'Evening block premium (4-8PM, +35%)', amount: premium });
                total += premium;
            } else if (window === currentBlock) {
                const premium = base * PREMIUM_CURRENT_BLOCK;
                premiums.push({ label: 'Current time block premium (+30%)', amount: premium });
                total += premium;
            } else {
                const premium = base * PREMIUM_NEXT_BLOCK;
                premiums.push({ label: 'Next available block premium (+20%)', amount: premium });
                total += premium;
            }
        } else if (isTomorrow) {
            if (isBookingSaturday) {
                const satPremium = base * PREMIUM_SATURDAY;
                premiums.push({ label: 'Saturday service premium (+30%)', amount: satPremium });
                total += satPremium;
            }
            if (isEveningBlock) {
                const premium = base * PREMIUM_EVENING_BLOCK;
                premiums.push({ label: 'Evening block premium (4-8PM, +35%)', amount: premium });
                total += premium;
            }
        } else if (isMonday) {
        }
        if (rush) {
            const premium = base * PREMIUM_RUSH;
            premiums.push({ label: 'Optional rush service (+10%)', amount: premium });
            total += premium;
        }
        if (addons > 0) {
            premiums.push({ label: 'Task-specific add-ons', amount: addons });
        }
        return { base, premiums, total, addons };
    }

    function saveFormData() {
        console.log('💾 Saving form data...');
        const futureDateInput = document.getElementById('futureDate').value;
        formData = {
            name: document.getElementById('customerName').value,
            phone: document.getElementById('customerPhone').value,
            email: document.getElementById('customerEmail').value,
            zip: document.getElementById('customerZip').value,
            address: document.getElementById('customerAddress').value,
            category: document.getElementById('taskCategory').value,
            window: document.getElementById('taskWindow').value,
            futureDate: futureDateInput || null,
            description: document.getElementById('taskDescription').value,
            rush: document.getElementById('rushOption').checked
        };
        console.log('✅ Form data saved to memory:', formData);
        return formData;
    }

    function showEstimateProgress() {
        const btn = document.getElementById('getEstimateBtn');
        const progressBg = document.getElementById('progressBg');
        const text = document.getElementById('estimateText');
        const container = document.getElementById('progressContainer');
        const bar = document.getElementById('progressBar');
        const message = document.getElementById('progressMessage');
        btn.disabled = true;
        container.classList.remove('hidden');
        text.textContent = '📤 Uploading photos...';
        message.textContent = 'Uploading photos and analyzing task...';
        progressBg.style.transform = 'translateX(-75%)';
        bar.style.width = '25%';
        setTimeout(() => {
            text.textContent = '🤖 AI analyzing...';
            message.textContent = 'AI is analyzing your photos and requirements...';
            progressBg.style.transform = 'translateX(-40%)';
            bar.style.width = '60%';
        }, 1500);
        setTimeout(() => {
            text.textContent = '💭 Generating options...';
            message.textContent = 'Creating your pricing options...';
            progressBg.style.transform = 'translateX(-10%)';
            bar.style.width = '90%';
        }, 3000);
        setTimeout(() => {
            text.textContent = '✅ Options ready!';
            message.textContent = 'Analysis complete! Options generated.';
            progressBg.style.transform = 'translateX(0%)';
            bar.style.width = '100%';
        }, 4000);
    }

    function resetEstimateProgress() {
        const btn = document.getElementById('getEstimateBtn');
        const progressBg = document.getElementById('progressBg');
        const text = document.getElementById('estimateText');
        const container = document.getElementById('progressContainer');
        const bar = document.getElementById('progressBar');
        setTimeout(() => {
            btn.disabled = false;
            text.textContent = '🔧 Get pricing options';
            container.classList.add('hidden');
            progressBg.style.transform = 'translateX(-100%)';
            bar.style.width = '0%';
        }, 1000);
    }

    async function generateEstimate() {
        console.log('🔄 Generate estimate button clicked!');
        try {
            const data = saveFormData();
            console.log('📋 Form data collected:', data);
            if (!data.name || !data.phone || !data.email || !data.category) {
                console.error('❌ Missing required fields');
                alert('Please fill out all required fields (Name, Phone, Email, and Task)');
                return;
            }
            if (data.futureDate) {
                const selectedDate = new Date(data.futureDate);
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                const maxDate = new Date(today);
                maxDate.setDate(maxDate.getDate() + 14);
                const minDate = new Date(today);
                minDate.setDate(minDate.getDate() + 2);
                if (selectedDate < minDate || selectedDate > maxDate) {
                    alert('Please select a date between 2 and 14 days in the future');
                    return;
                }
            }
            console.log('✅ Validation passed, starting progress animation...');
            showEstimateProgress();
            const hours = TASKS[data.category]?.hours || 1.5;
            const addons = calculateAddons(data.category);
            const aiPayload = {
                category: data.category,
                description: data.description,
                base_rate_hr: RATE,
                hours_base: hours,
                window: data.window,
                rush: data.rush,
                addons: addons,
                futureDate: data.futureDate,
                name: data.name,
                phone: data.phone,
                email: data.email,
                address: data.address
            };
            console.log('📤 Calling AI scope function with payload:', aiPayload);
            const response = await fetch('/.netlify/functions/scope', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(aiPayload)
            });
            console.log('📡 AI scope response status:', response.status);
            if (!response.ok) {
                const errorText = await response.text();
                console.error('❌ AI scope failed:', response.status, errorText);
                throw new Error(`AI estimate failed: ${response.status}`);
            }
            const aiResult = await response.json();
            console.log('📊 AI scope result:', aiResult);
            const pricingOptions = generatePricingOptions(hours, data.window, data.rush, addons, data.futureDate);
            console.log('💰 Generated pricing options:', pricingOptions);
            console.log('📊 Future date selected:', data.futureDate);
            console.log('🔢 Number of options:', pricingOptions.length);
            estimateData = {
                ...aiResult,
                hours,
                pricingOptions,
                futureDate: data.futureDate
            };
            console.log('✅ Estimate data stored:', estimateData);
            setTimeout(() => {
                console.log('🎯 Showing estimate panel...');
                showEstimatePanel(estimateData);
                resetEstimateProgress();
            }, 4500);
        } catch (error) {
            console.error('❌ Generate estimate error:', error);
            alert('Failed to generate estimate: ' + error.message);
            resetEstimateProgress();
        }
    }

    function generatePricingOptions(hours, selectedWindow, rush, addons = 0, selectedDate = null) {
        const options = [];
        const availableWindows = getAvailableTimeWindows();

        if (selectedDate) {
            const dateObj = new Date(selectedDate + 'T00:00:00');

            if (isSunday(dateObj)) {
                alert('Sunday bookings are not available. Please select a different date.');
                return [];
            }

            const isSelectedSaturday = isSaturday(dateObj);

            // Calculate day before and day after
            const dayBefore = new Date(dateObj);
            dayBefore.setDate(dayBefore.getDate() - 1);
            let dayAfter = new Date(dateObj);
            dayAfter.setDate(dayAfter.getDate() + 1);

            // Skip Sunday for day after
            if (isSunday(dayAfter)) {
                dayAfter.setDate(dayAfter.getDate() + 1); // Move to Monday
            }

            const formattedDateBefore = dayBefore.toLocaleDateString('en-US', {
                weekday: 'short',
                month: 'short',
                day: 'numeric'
            });

            const formattedDateSelected = dateObj.toLocaleDateString('en-US', {
                weekday: 'short',
                month: 'short',
                day: 'numeric'
            });

            const formattedDateAfter = dayAfter.toLocaleDateString('en-US', {
                weekday: 'short',
                month: 'short',
                day: 'numeric'
            });

            const isDayBeforeSaturday = isSaturday(dayBefore);
            const isDayAfterSaturday = isSaturday(dayAfter);

            // Helper function to get time block label
            const getTimeBlockLabel = (blockKey) => {
                if (blockKey === 'morning') return '8AM-12PM';
                if (blockKey === 'afternoon') return '12PM-4PM';
                if (blockKey === 'evening') return '4PM-8PM';
                return '';
            };

            // Helper function to create pricing option
            const createOption = (date, block, dateLabel, sectionType, isSat) => {
                const dateString = date.toISOString().split('T')[0];
                // Pass correct window identifier for evening blocks
                const windowIdentifier = block.key === 'evening' ? 'tomorrow_eve' : 'tomorrow_am';
                const pricing = calculatePricing(hours, windowIdentifier, rush, addons, dateString);

                let badge, badgeClass;
                if (block.key === 'evening') {
                    badge = 'Evening +35%';
                    badgeClass = 'premium';
                } else if (isSat) {
                    badge = 'Saturday +30%';
                    badgeClass = 'premium';
                } else {
                    badge = 'Future -15%';
                    badgeClass = 'discount';
                }

                return {
                    type: 'future',
                    window: `future_${date.getTime()}_${block.key}`,
                    windowLabel: `${dateLabel} (${block.label})`,
                    pricing: pricing,
                    badge: badge,
                    badgeClass: badgeClass,
                    selectedDate: dateString,
                    timeBlock: block,
                    sectionType: sectionType
                };
            };

            const allTimeBlocks = [
                { key: 'morning', label: '8AM-12PM', start: 8, end: 12 },
                { key: 'afternoon', label: '12PM-4PM', start: 12, end: 16 },
                { key: 'evening', label: '4PM-8PM', start: 16, end: 20 }
            ];

            // DAY BEFORE OPTIONS (all 3 time slots unless Saturday)
            const dayBeforeBlocks = isDayBeforeSaturday ? [allTimeBlocks[0]] : allTimeBlocks;
            dayBeforeBlocks.forEach(block => {
                options.push(createOption(
                    dayBefore,
                    block,
                    formattedDateBefore,
                    'Day Before (Better Value)',
                    isDayBeforeSaturday
                ));
            });

            // SELECTED DATE OPTIONS (all available time slots, or skip if Saturday)
            if (!isSelectedSaturday) {
                allTimeBlocks.forEach(block => {
                    options.push(createOption(
                        dateObj,
                        block,
                        formattedDateSelected,
                        'Your Selected Date',
                        false
                    ));
                });
            } else {
                // For Saturday, only show morning slot
                options.push(createOption(
                    dateObj,
                    allTimeBlocks[0],
                    formattedDateSelected,
                    'Your Selected Date (Saturday)',
                    true
                ));
            }

            // DAY AFTER OPTIONS (all 3 time slots unless Saturday)
            const dayAfterBlocks = isDayAfterSaturday ? [allTimeBlocks[0]] : allTimeBlocks;
            dayAfterBlocks.forEach(block => {
                options.push(createOption(
                    dayAfter,
                    block,
                    formattedDateAfter,
                    'Day After (Better Value)',
                    isDayAfterSaturday
                ));
            });

            return options;
        }

        if (selectedWindow === 'flexible') {
            const now = new Date();
            const tomorrow = new Date(now);
            tomorrow.setDate(tomorrow.getDate() + 1);
            let flexibleWindow;
            let flexibleLabel;
            if (isSunday(tomorrow)) {
                flexibleWindow = 'monday_am';
                flexibleLabel = 'Monday Morning (8AM-12PM) - Best Value';
            }
            else if (isSaturday(tomorrow)) {
                flexibleWindow = 'tomorrow_am';
                flexibleLabel = 'Tomorrow Morning (8AM-12PM) - Saturday';
            }
            else {
                flexibleWindow = 'tomorrow_am';
                flexibleLabel = 'Tomorrow Morning (8AM-12PM) - Best Value';
            }
            const pricing = calculatePricing(hours, flexibleWindow, rush, addons);
            options.push({
                type: 'flexible',
                window: flexibleWindow,
                windowLabel: flexibleLabel,
                pricing: pricing,
                badge: isSaturday(tomorrow) ? 'Saturday' : 'Best Value',
                badgeClass: isSaturday(tomorrow) ? 'premium' : 'discount'
            });
            availableWindows.forEach(window => {
                if (window !== flexibleWindow && !window.includes('today')) {
                    const altPricing = calculatePricing(hours, window, rush, addons);
                    const windowDate = new Date(now);
                    if (window.startsWith('tomorrow')) {
                        windowDate.setDate(windowDate.getDate() + 1);
                    } else if (window.startsWith('monday')) {
                        windowDate.setDate(windowDate.getDate() + 2);
                    }
                    const isAltSaturday = isSaturday(windowDate);
                    options.push({
                        type: 'alternative',
                        window: window,
                        windowLabel: TIME_WINDOWS[window].label,
                        pricing: altPricing,
                        badge: isAltSaturday ? 'Saturday' : 'Good Value',
                        badgeClass: isAltSaturday ? 'premium' : 'selected'
                    });
                }
            });
            return options;
        }

        availableWindows.forEach(window => {
            const pricing = calculatePricing(hours, window, rush, addons);
            const isSelected = window === selectedWindow;
            const now = new Date();
            let windowDate = new Date(now);
            if (window.startsWith('tomorrow')) {
                windowDate.setDate(windowDate.getDate() + 1);
            } else if (window.startsWith('monday')) {
                windowDate.setDate(windowDate.getDate() + 2);
            }
            const isWindowSaturday = isSaturday(windowDate);
            let badge, badgeClass, type;
            if (window.startsWith('today')) {
                badge = isWindowSaturday ? 'Saturday' : 'Today';
                badgeClass = 'premium';
                type = 'today';
            } else if (window.includes('eve')) {
                badge = 'Evening';
                badgeClass = 'premium';
                type = 'evening';
            } else if (window.startsWith('monday')) {
                badge = 'Monday';
                badgeClass = 'selected';
                type = 'monday';
            } else {
                badge = isWindowSaturday ? 'Saturday' : 'Tomorrow';
                badgeClass = isWindowSaturday ? 'premium' : 'selected';
                type = 'tomorrow';
            }
            if (isSelected) {
                badge = 'Selected';
            }
            options.push({
                type: type,
                window: window,
                windowLabel: TIME_WINDOWS[window].label,
                pricing: pricing,
                badge: badge,
                badgeClass: badgeClass
            });
        });
        return options;
    }

    function showEstimatePanel(estimate) {
        const isFlexible = formData.window === 'flexible';
        const hasFutureDate = formData.futureDate !== null && formData.futureDate !== '';

        const flexibleNotice = document.getElementById('flexibleNotice');
        const futureDateNotice = document.getElementById('futureDateNotice');

        // Safety check - if elements don't exist, log and continue
        if (!flexibleNotice) {
            console.warn('⚠️ flexibleNotice element not found');
        }
        if (!futureDateNotice) {
            console.warn('⚠️ futureDateNotice element not found');
        }

        if (isFlexible && flexibleNotice) {
            flexibleNotice.classList.remove('hidden');
            if (futureDateNotice) futureDateNotice.classList.add('hidden');
        } else if (hasFutureDate && futureDateNotice) {
            if (flexibleNotice) flexibleNotice.classList.add('hidden');
            futureDateNotice.classList.remove('hidden');
        } else {
            if (flexibleNotice) flexibleNotice.classList.add('hidden');
            if (futureDateNotice) futureDateNotice.classList.add('hidden');
        }

        const optionsContainer = document.getElementById('pricingOptions');
        optionsContainer.innerHTML = '';

        // Group options by section if they have sectionType
        const hasSections = estimate.pricingOptions.some(opt => opt.sectionType);

        if (hasSections) {
            // Group by section
            const sections = {};
            estimate.pricingOptions.forEach(option => {
                const sectionName = option.sectionType || 'Other';
                if (!sections[sectionName]) {
                    sections[sectionName] = [];
                }
                sections[sectionName].push(option);
            });

            // Define section order
            const sectionOrder = ['Day Before (Better Value)', 'Your Selected Date', 'Your Selected Date (Saturday)', 'Day After (Better Value)'];

            sectionOrder.forEach(sectionName => {
                if (sections[sectionName]) {
                    // Add section divider (except for first section)
                    if (optionsContainer.children.length > 0) {
                        const divider = document.createElement('div');
                        divider.className = 'section-divider';
                        optionsContainer.appendChild(divider);
                    }

                    // Add section header
                    const sectionHeader = document.createElement('div');
                    sectionHeader.className = 'section-header-wrapper';

                    let headerClass = 'text-base font-bold';
                    let icon = '';
                    let description = '';

                    if (sectionName.includes('Better Value')) {
                        headerClass += ' text-green-700';
                        icon = '💰 ';
                        description = '<span class="text-xs font-normal text-green-600 ml-2">(Save money with these options)</span>';
                    } else if (sectionName.includes('Saturday')) {
                        headerClass += ' text-orange-700';
                        icon = '📅 ';
                        description = '<span class="text-xs font-normal text-orange-600 ml-2">(Premium pricing applies)</span>';
                    } else {
                        headerClass += ' text-indigo-700';
                        icon = '📌 ';
                    }

                    sectionHeader.innerHTML = `<div class="${headerClass}">${icon}${sectionName}${description}</div>`;
                    optionsContainer.appendChild(sectionHeader);

                    // Add options for this section
                    sections[sectionName].forEach((option, index) => {
                        const optionCard = createPricingOptionCard(option, estimate.hours, index === 0 && sectionName === 'Your Selected Date');
                        optionsContainer.appendChild(optionCard);
                    });
                }
            });
        } else {
            // No sections - display normally
            estimate.pricingOptions.forEach((option, index) => {
                const optionCard = createPricingOptionCard(option, estimate.hours, index === 0);
                optionsContainer.appendChild(optionCard);
            });
        }

        document.getElementById('estimateScope').innerHTML = (estimate.step_scope || []).map(s => `<li>${s}</li>`).join('');
        document.getElementById('estimateRisks').innerHTML = (estimate.risk_flags || []).map(r => `<li>${r}</li>`).join('');
        document.getElementById('estimatePanel').classList.remove('hidden');
        document.getElementById('estimatePanel').scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    function createPricingOptionCard(option, hours, autoSelect) {
        const optionCard = document.createElement('div');
        optionCard.className = 'pricing-option relative border-2 border-slate-200 rounded-xl p-4 cursor-pointer';
        optionCard.dataset.optionType = option.type;
        optionCard.dataset.window = option.window;

        let breakdownHTML = '';
        if (option.pricing.premiums && option.pricing.premiums.length > 0) {
            breakdownHTML = '<div class="text-xs text-slate-500 mt-2">';
            option.pricing.premiums.forEach(premium => {
                const sign = premium.amount >= 0 ? '+' : '';
                breakdownHTML += `<div>${premium.label}: ${sign}${Math.abs(premium.amount).toFixed(0)}</div>`;
            });
            breakdownHTML += '</div>';
        }

        optionCard.innerHTML = `
            <div class="pricing-badge ${option.badgeClass}">${option.badge}</div>
            <div class="flex items-center justify-between">
                <div>
                    <div class="font-semibold text-lg">${option.windowLabel}</div>
                    <div class="text-sm text-slate-600">${hours.toFixed(1)} hours estimated</div>
                </div>
                <div class="text-right">
                    <div class="text-2xl font-bold">${option.pricing.total.toFixed(0)}</div>
                </div>
            </div>
            ${breakdownHTML}
        `;

        optionCard.addEventListener('click', () => selectPricingOption(option, optionCard));

        if (autoSelect) {
            setTimeout(() => selectPricingOption(option, optionCard), 100);
        }

        return optionCard;
    }

    function selectPricingOption(option, cardElement) {
        document.querySelectorAll('.pricing-option').forEach(card => {
            card.classList.remove('selected');
        });
        cardElement.classList.add('selected');
        selectedPricingOption = {
            ...option,
            window: option.window,
            windowLabel: option.windowLabel,
            type: option.type,
            pricing: { ...option.pricing }
        };
        document.getElementById('reserveBtn').disabled = false;
        debugPricingFlow('OPTION_SELECTED', option);
        console.log('✅ Selected pricing option:', selectedPricingOption);
    }

    async function showPaymentModal() {
        if (!selectedPricingOption) {
            alert('Please select a pricing option first');
            return;
        }
        if (!stripe) {
            alert('Payment system is still loading. Please try again in a moment.');
            return;
        }
        const finalAmount = selectedPricingOption.pricing.total;
        debugPricingFlow('PAYMENT_MODAL_OPENED', {
            selectedOption: selectedPricingOption,
            finalAmount: finalAmount
        });
        document.getElementById('paymentAmount').textContent = '$' + finalAmount.toFixed(0);
        document.getElementById('paymentTiming').textContent = selectedPricingOption.windowLabel;
        document.getElementById('paymentModal').classList.remove('hidden');
        paymentElementReady = false;
        const paymentMessage = document.getElementById('paymentMessage');
        paymentMessage.classList.add('hidden');
        paymentMessage.textContent = '';
        try {
            console.log('🔄 Setting up payment intent...');
            console.log('💰 Amount being sent:', finalAmount, 'USD');
            const response = await fetch('/.netlify/functions/create-payment', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    amount: finalAmount,
                    currency: 'usd',
                    customer_info: {
                        name: formData.name,
                        email: formData.email,
                        phone: formData.phone
                    },
                    job_details: {
                        category: formData.category,
                        window: selectedPricingOption.window,
                        hours: estimateData.hours,
                        selected_option_type: selectedPricingOption.type,
                        futureDate: formData.futureDate
                    }
                })
            });
            if (!response.ok) {
                const errorData = await response.json().catch(() => ({}));
                console.error('❌ Payment intent creation failed:', {
                    status: response.status,
                    statusText: response.statusText,
                    error: errorData
                });
                throw new Error(errorData.error || `Payment setup failed: ${response.status}`);
            }
            const result = await response.json();
            console.log('✅ Payment intent created successfully:', {
                id: result.payment_intent_id,
                hasClientSecret: !!result.client_secret
            });
            if (!result.client_secret) {
                throw new Error('No client secret received from server');
            }
            paymentIntentId = result.payment_intent_id;
            console.log('✅ Payment intent created:', paymentIntentId);
            if (elements) {
                try {
                    elements = null;
                } catch (e) {
                    console.log('Element cleanup:', e.message);
                }
            }
            if (paymentElement) {
                try {
                    paymentElement.unmount();
                    paymentElement = null;
                } catch (e) {
                    console.log('Previous element unmount:', e.message);
                }
            }
            console.log('💳 Initializing Stripe Elements...');
            elements = stripe.elements({
                clientSecret: result.client_secret,
                appearance: {
                    theme: 'stripe',
                    variables: {
                        colorPrimary: '#4f46e5',
                    }
                }
            });
            paymentElement = elements.create('payment', {
                layout: {
                    type: 'tabs',
                    defaultCollapsed: false
                }
            });
            const mountTarget = document.getElementById('stripe-payment-element');
            if (!mountTarget) {
                throw new Error('Payment element container not found');
            }
            mountTarget.innerHTML = '';
            await new Promise((resolve, reject) => {
                let mounted = false;
                let readyFired = false;
                paymentElement.mount('#stripe-payment-element');
                paymentElement.on('ready', () => {
                    console.log('✅ Payment element mounted and ready');
                    paymentElementReady = true;
                    mounted = true;
                    readyFired = true;
                    resolve();
                });
                paymentElement.on('loaderror', (error) => {
                    console.error('❌ Payment element load error:', error);
                    reject(new Error(error.error?.message || 'Failed to load payment form'));
                });
                paymentElement.on('change', (event) => {
                    if (event.complete) {
                        console.log('✅ Payment details complete');
                    }
                    if (event.error) {
                        console.warn('⚠️ Payment validation error:', event.error.message);
                    }
                });
                setTimeout(() => {
                    if (!readyFired) {
                        console.warn('⚠️ Payment element ready event timeout');
                        const elementInDom = document.querySelector('#stripe-payment-element iframe');
                        if (elementInDom) {
                            console.log('✅ Payment element iframe found in DOM, assuming ready');
                            paymentElementReady = true;
                            resolve();
                        } else {
                            reject(new Error('Payment element failed to mount'));
                        }
                    }
                }, 8000);
            });
        } catch (error) {
            console.error('❌ Payment setup error:', error);
            paymentMessage.textContent = 'Unable to load payment form. Please try again or contact support.';
            paymentMessage.classList.remove('hidden');
            paymentMessage.className = 'mt-4 text-sm text-red-600 p-3 bg-red-50 rounded-lg';
            setTimeout(() => {
                document.getElementById('paymentModal').classList.add('hidden');
            }, 3000);
        }
    }

    async function processPayment(event) {
        event.preventDefault();
        const submitBtn = document.getElementById('submitPayment');
        const btnText = document.getElementById('paymentButtonText');
        const paymentMessage = document.getElementById('paymentMessage');
        if (!stripe) {
            alert('Payment system not initialized. Please refresh the page.');
            return;
        }
        if (!elements || !paymentElement) {
            alert('Payment form not ready. Please close and reopen the payment window.');
            return;
        }
        if (!paymentElementReady) {
            alert('Payment form is still loading. Please wait a moment and try again.');
            return;
        }
        const elementInDom = document.querySelector('#stripe-payment-element iframe');
        if (!elementInDom) {
            console.error('❌ Payment element iframe not found in DOM');
            alert('Payment form not properly loaded. Please close and reopen the payment window.');
            return;
        }
        if (!selectedPricingOption) {
            alert('No pricing option selected. Please go back and select an option.');
            return;
        }
        console.log('✅ All validation checks passed, proceeding with payment');
        submitBtn.disabled = true;
        btnText.textContent = 'Processing payment...';
        paymentMessage.classList.add('hidden');
        debugPricingFlow('PAYMENT_PROCESSING', null);
        try {
            console.log('🔄 Confirming payment for amount:', selectedPricingOption.pricing.total);
            const { error: submitError } = await elements.submit();
            if (submitError) {
                throw new Error(submitError.message);
            }
            const { error, paymentIntent } = await stripe.confirmPayment({
                elements,
                confirmParams: {
                    return_url: `${window.location.origin}${window.location.pathname}#success`,
                    payment_method_data: {
                        billing_details: {
                            name: formData.name,
                            email: formData.email,
                            phone: formData.phone,
                            address: {
                                postal_code: formData.zip
                            }
                        }
                    }
                },
                redirect: 'if_required'
            });
            if (error) {
                throw new Error(error.message);
            }
            if (paymentIntent && paymentIntent.status === 'succeeded') {
                console.log('✅ Payment successful:', paymentIntent.id);
                paymentIntentId = paymentIntent.id;
                document.getElementById('paymentModal').classList.add('hidden');
                showTaskInfoModal();
            } else if (paymentIntent && paymentIntent.status === 'requires_action') {
                console.log('⏳ Payment requires additional authentication');
                btnText.textContent = 'Authenticating...';
            } else {
                throw new Error('Payment was not completed successfully');
            }
        } catch (error) {
            console.error('❌ Payment failed:', error);
            let userMessage = 'Payment failed. Please try again.';
            if (error.message.includes('incomplete')) {
                userMessage = 'Please complete all payment details.';
            } else if (error.message.includes('card_declined')) {
                userMessage = 'Your card was declined. Please try a different card.';
            } else if (error.message.includes('insufficient_funds')) {
                userMessage = 'Insufficient funds. Please try a different card.';
            } else if (error.message.includes('expired_card')) {
                userMessage = 'Your card has expired. Please try a different card.';
            } else if (error.message.includes('incorrect_cvc')) {
                userMessage = 'Incorrect CVC code. Please check and try again.';
            } else if (error.message.includes('processing_error')) {
                userMessage = 'Processing error. Please try again in a moment.';
            } else if (error.message) {
                userMessage = error.message;
            }
            paymentMessage.textContent = userMessage;
            paymentMessage.classList.remove('hidden');
            paymentMessage.className = 'mt-4 text-sm text-red-600 p-3 bg-red-50 rounded-lg border border-red-200';
            submitBtn.disabled = false;
            btnText.textContent = 'Complete Payment';
        }
    }

    function showTaskInfoModal() {
        const taskId = generateTaskId();
        window.currentTaskId = taskId;
        const paidAmount = selectedPricingOption.pricing.total;
        document.getElementById('summaryTaskId').textContent = taskId;
        document.getElementById('summaryName').textContent = formData.name;
        document.getElementById('summaryPhone').textContent = formData.phone;
        document.getElementById('summaryEmail').textContent = formData.email;
        document.getElementById('summaryTask').textContent = TASKS[formData.category]?.label || formData.category;
        document.getElementById('summaryWindow').textContent = selectedPricingOption.windowLabel;
        document.getElementById('summaryDescription').textContent = formData.description || 'None provided';
        document.getElementById('summaryAmount').textContent = '$' + paidAmount.toFixed(2);
        document.getElementById('contactPhone').value = formData.phone;
        document.getElementById('taskInfoModal').classList.remove('hidden');
    }

    async function submitTaskInfo(event) {
        event.preventDefault();
        const propertyAddress = document.getElementById('propertyAddress').value;
        const addressValidation = validatePropertyAddress(propertyAddress);
        if (!addressValidation.valid) {
            alert('Address Error: ' + addressValidation.message);
            document.getElementById('propertyAddress').focus();
            return;
        }
        const submitBtn = event.target.querySelector('button[type="submit"]');
        submitBtn.disabled = true;
        submitBtn.textContent = '📤 Sending notification...';
        const taskId = window.currentTaskId;
        const currentFormData = saveFormData();
        if (!currentFormData.name || !currentFormData.phone || !currentFormData.email || !currentFormData.category) {
            console.error('❌ Missing critical form data');
            alert('Critical form data is missing. Please refresh and try again.');
            submitBtn.disabled = false;
            submitBtn.textContent = '🚀 Dispatch Handyman';
            return;
        }
        const completeJobData = {
            task_id: taskId,
            payment_intent_id: paymentIntentId,
            category: currentFormData.category,
            window: selectedPricingOption.window,
            name: currentFormData.name,
            phone: currentFormData.phone,
            email: currentFormData.email,
            zip: currentFormData.zip,
            address: currentFormData.address || '',
            description: currentFormData.description || '',
            rush: currentFormData.rush || false,
            property_address: propertyAddress,
            contact_phone: document.getElementById('contactPhone').value,
            access_details: document.getElementById('accessDetails').value || '',
            pets_and_special: document.getElementById('petsAndSpecial').value || '',
            additional_details: document.getElementById('additionalDetails').value || '',
            estimated_hours: estimateData.hours,
            total_amount: selectedPricingOption.pricing.total,
            base_amount: selectedPricingOption.pricing.base,
            premiums: selectedPricingOption.pricing.premiums || [],
            step_scope: estimateData.step_scope || [],
            risk_flags: estimateData.risk_flags || [],
            customer: {
                name: currentFormData.name,
                phone: currentFormData.phone,
                email: currentFormData.email,
                zip: currentFormData.zip,
                address: currentFormData.address || '',
                category: currentFormData.category,
                window: selectedPricingOption.window,
                description: currentFormData.description || '',
                rush: currentFormData.rush || false
            },
            task_info: {
                property_address: propertyAddress,
                contact_phone: document.getElementById('contactPhone').value,
                access_details: document.getElementById('accessDetails').value || '',
                pets_and_special: document.getElementById('petsAndSpecial').value || '',
                additional_details: document.getElementById('additionalDetails').value || ''
            },
            estimate: {
                hours: estimateData.hours,
                pricing: selectedPricingOption.pricing,
                step_scope: estimateData.step_scope || [],
                risk_flags: estimateData.risk_flags || []
            },
            amount: selectedPricingOption.pricing.total
        };
        try {
            await sendSMSNotification('booking_confirmation', {
                customer_phone: completeJobData.phone,
                task_id: taskId,
                service_name: TASKS[completeJobData.category]?.label,
                time_window: TIME_WINDOWS[completeJobData.window]?.label || completeJobData.window,
                total_amount: selectedPricingOption.pricing.total.toFixed(0)
            });
        } catch (smsError) {
            console.log('📱 SMS failed but continuing:', smsError);
        }
        try {
            await sendZapierNotification(completeJobData);
        } catch (zapierError) {
            console.error('❌ Zapier notification failed:', zapierError);
        }
        try {
            const response = await fetch('/.netlify/functions/send-notification', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(completeJobData)
            });
            if (response.ok) {
                const result = await response.json();
                console.log('✅ Notification sent successfully:', result);
            }
        } catch (error) {
            console.error('❌ Notification error:', error);
        }
        document.getElementById('finalTaskId').textContent = taskId;
        document.getElementById('finalPaidAmount').textContent = '$' + selectedPricingOption.pricing.total.toFixed(2);
        document.getElementById('taskInfoModal').classList.add('hidden');
        document.getElementById('finalSuccessModal').classList.remove('hidden');
    }

    function initializeMobileMenu() {
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const mobileMenu = document.getElementById('mobile-menu');
        mobileMenuBtn.addEventListener('click', () => {
            mobileMenu.classList.toggle('active');
        });
        document.querySelectorAll('#mobile-menu a').forEach(link => {
            link.addEventListener('click', () => {
                mobileMenu.classList.remove('active');
            });
        });
        document.addEventListener('click', (e) => {
            if (!mobileMenuBtn.contains(e.target) && !mobileMenu.contains(e.target)) {
                mobileMenu.classList.remove('active');
            }
        });
    }

    function initializeChatbot() {
        const chatToggle = document.getElementById('chatbot-toggle');
        const chatWindow = document.getElementById('chatbot-window');
        const chatClose = document.getElementById('chatbot-close');
        const chatInput = document.getElementById('chatbot-input');
        const chatSend = document.getElementById('chatbot-send');
        const chatMessages = document.getElementById('chatbot-messages');
        let conversationHistory = [];
        let isOpen = false;
        chatToggle.addEventListener('click', () => {
            isOpen = !isOpen;
            if (isOpen) {
                chatWindow.classList.remove('hidden');
                chatInput.focus();
            } else {
                chatWindow.classList.add('hidden');
            }
        });
        chatClose.addEventListener('click', () => {
            isOpen = false;
            chatWindow.classList.add('hidden');
        });
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });
        chatSend.addEventListener('click', sendMessage);
        async function sendMessage() {
            const message = chatInput.value.trim();
            if (!message) return;
            addMessage(message, 'user');
            chatInput.value = '';
            const typingIndicator = addTypingIndicator();
            try {
                const response = await fetch('/.netlify/functions/chatbot', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: message,
                        conversationHistory: conversationHistory
                    })
                });
                typingIndicator.remove();
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const result = await response.json();
                if (result.error) {
                    addMessage(result.error, 'bot', true);
                } else {
                    addMessage(result.reply, 'bot');
                }
                conversationHistory.push(
                    { role: 'human', content: message },
                    { role: 'assistant', content: result.reply || 'Error occurred' }
                );
                if (conversationHistory.length > 20) {
                    conversationHistory = conversationHistory.slice(-20);
                }
            } catch (error) {
                console.error('Chatbot error:', error);
                typingIndicator.remove();
                addMessage('Sorry, I\'m having trouble connecting right now. Please try again or contact us directly at info@sendahandyman.com', 'bot', true);
            }
        }
        function addMessage(content, sender, isError = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'flex items-start space-x-2';
            if (sender === 'user') {
                messageDiv.innerHTML = `
                    <div class="flex-1"></div>
                    <div class="bg-indigo-600 text-white rounded-lg p-3 max-w-xs">
                        <p class="text-sm">${escapeHtml(content)}</p>
                    </div>
                    <div class="w-8 h-8 rounded-full bg-indigo-600 flex items-center justify-center flex-shrink-0">
                        <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                    </div>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div class="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center flex-shrink-0">
                        <svg class="w-4 h-4 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                        </svg>
                    </div>
                    <div class="bg-slate-100 rounded-lg p-3 max-w-xs ${isError ? 'border border-red-200 bg-red-50' : ''}">
                        <p class="text-sm text-slate-700">${formatBotMessage(content)}</p>
                    </div>
                `;
            }
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        function addTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.className = 'flex items-start space-x-2';
            typingDiv.innerHTML = `
                <div class="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center flex-shrink-0">
                    <svg class="w-4 h-4 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                    </svg>
                </div>
                <div class="bg-slate-100 rounded-lg p-3">
                    <p class="text-sm text-slate-500 chatbot-typing">Typing</p>
                </div>
            `;
            chatMessages.appendChild(typingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            return typingDiv;
        }
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        function formatBotMessage(content) {
            return escapeHtml(content)
                .replace(/\n/g, '<br>')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>');
        }
        console.log('✅ Chatbot initialized');
    }

    document.addEventListener('DOMContentLoaded', () => {
        console.log('🚀 DOM Content Loaded - Initializing app...');
        console.log('📊 App Version:', APP_VERSION);
        function populateTimeWindows() {
            const select = document.getElementById('taskWindow');
            if (!select) {
                console.error('❌ taskWindow select element not found');
                return;
            }
            const availableWindows = getAvailableTimeWindows();
            select.innerHTML = '<option value="flexible">I\'m flexible (best value)</option>';
            const separator = document.createElement('option');
            separator.disabled = true;
            separator.textContent = '──────────────────';
            select.appendChild(separator);
            availableWindows.forEach(windowKey => {
                const option = document.createElement('option');
                option.value = windowKey;
                option.textContent = TIME_WINDOWS[windowKey].label;
                select.appendChild(option);
            });
            console.log('⏰ Available time windows:', availableWindows);
            console.log('⏰ Dropdown populated with', select.options.length, 'options (Sundays excluded)');
        }
        try {
            populateTimeWindows();
            setInterval(populateTimeWindows, 60000);
        } catch (error) {
            console.error('❌ Error populating time windows:', error);
        }
        function setupDatePicker() {
            const dateInput = document.getElementById('futureDate');
            if (!dateInput) {
                console.error('❌ futureDate input not found');
                return;
            }
            const today = new Date();
            const minDate = new Date(today);
            minDate.setDate(minDate.getDate() + 2);
            const maxDate = new Date(today);
            maxDate.setDate(maxDate.getDate() + 14);
            dateInput.min = minDate.toISOString().split('T')[0];
            dateInput.max = maxDate.toISOString().split('T')[0];

            // Improved validation with clearer messages
            dateInput.addEventListener('change', function(e) {
                if (!e.target.value) return;

                const selectedDate = new Date(e.target.value + 'T00:00:00');

                if (isSunday(selectedDate)) {
                    alert('🚫 SUNDAYS NOT AVAILABLE\n\nWe do not offer service on Sundays. Please select Monday-Saturday.');
                    e.target.value = '';
                    return;
                }

                if (isSaturday(selectedDate)) {
                    alert('📅 SATURDAY BOOKING NOTICE\n\n• Only 8AM-12PM time slot available\n• 30% Saturday premium applies\n• NO 15% future booking discount\n\nNet result: +30% premium for Saturday service');
                }
            });

            // Also block on input to prevent Sunday selection
            dateInput.addEventListener('input', function(e) {
                if (!e.target.value) return;
                const selectedDate = new Date(e.target.value + 'T00:00:00');
                if (isSunday(selectedDate)) {
                    e.target.value = '';
                }
            });

            console.log('📅 Date picker configured: min=', dateInput.min, 'max=', dateInput.max, '(Sundays blocked, Saturdays +30%)');
        }
        try {
            setupDatePicker();
        } catch (error) {
            console.error('❌ Error setting up date picker:', error);
        }
        initializeStripe();
        console.log('🎯 Zapier webhook configured:', ZAPIER_CONFIG.ENABLED ? 'YES' : 'NO');
        initializeMobileMenu();
        const serviceCards = document.querySelectorAll('.service-card');
        console.log('🎴 Found', serviceCards.length, 'service cards');
        document.querySelectorAll('.service-card').forEach(card => {
            const header = card.querySelector('.service-header');
            if (header) {
                header.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const taskKey = card.getAttribute('data-task');
                    console.log('🎯 Service card clicked:', taskKey);
                    const details = card.querySelector('.service-details');
                    const icon = card.querySelector('.expand-icon');
                    document.querySelectorAll('.service-card').forEach(otherCard => {
                        if (otherCard !== card) {
                            const otherDetails = otherCard.querySelector('.service-details');
                            const otherIcon = otherCard.querySelector('.expand-icon');
                            if (otherDetails) otherDetails.classList.add('hidden');
                            if (otherIcon) otherIcon.style.transform = 'rotate(0deg)';
                        }
                    });
                    if (details && icon) {
                        if (details.classList.contains('hidden')) {
                            details.classList.remove('hidden');
                            icon.style.transform = 'rotate(180deg)';
                            const taskDropdown = document.getElementById('taskCategory');
                            if (taskDropdown) {
                                taskDropdown.value = taskKey;
                                console.log('✅ Task dropdown set to:', taskKey);
                            }
                            showTaskQuestions(taskKey);
                            setTimeout(() => {
                                const bookSection = document.getElementById('book');
                                if (bookSection) {
                                    bookSection.scrollIntoView({ behavior: 'smooth' });
                                }
                            }, 300);
                        } else {
                            details.classList.add('hidden');
                            icon.style.transform = 'rotate(0deg)';
                        }
                    }
                });
                console.log('✅ Event listener added to service card:', card.getAttribute('data-task'));
            } else {
                console.warn('⚠️ Service header not found for card:', card.getAttribute('data-task'));
            }
        });
        const taskCategoryDropdown = document.getElementById('taskCategory');
        if (taskCategoryDropdown) {
            taskCategoryDropdown.addEventListener('change', (e) => {
                const taskKey = e.target.value;
                console.log('📝 Task category changed to:', taskKey);
                if (taskKey) {
                    showTaskQuestions(taskKey);
                } else {
                    document.getElementById('taskQuestions').classList.add('hidden');
                }
            });
            console.log('✅ Task category dropdown listener added');
        } else {
            console.error('❌ Task category dropdown not found');
        }
        console.log('✅ Service selection system initialized');
        const photoInput = document.getElementById('taskPhotos');
        if (photoInput) {
            photoInput.addEventListener('change', (e) => {
                const thumbs = document.getElementById('photoThumbs');
                if (thumbs) {
                    thumbs.innerHTML = '';
                    [...e.target.files].slice(0, 5).forEach(file => {
                        const url = URL.createObjectURL(file);
                        const img = document.createElement('img');
                        img.src = url;
                        img.className = 'h-16 w-16 object-cover rounded-lg border';
                        thumbs.appendChild(img);
                    });
                }
            });
            console.log('✅ Photo upload listener added');
        } else {
            console.error('❌ Photo input not found');
        }
        const getEstimateBtn = document.getElementById('getEstimateBtn');
        if (getEstimateBtn) {
            getEstimateBtn.addEventListener('click', generateEstimate);
            console.log('✅ Get estimate button listener added');
        } else {
            console.error('❌ Get estimate button not found');
        }
        const reserveBtn = document.getElementById('reserveBtn');
        if (reserveBtn) {
            reserveBtn.addEventListener('click', showPaymentModal);
            console.log('✅ Reserve button listener added');
        } else {
            console.error('❌ Reserve button not found');
        }
        const paymentForm = document.getElementById('paymentForm');
        if (paymentForm) {
            paymentForm.addEventListener('submit', processPayment);
            console.log('✅ Payment form listener added');
        } else {
            console.error('❌ Payment form not found');
        }
        const closePaymentBtn = document.getElementById('closePayment');
        if (closePaymentBtn) {
            closePaymentBtn.addEventListener('click', () => {
                if (paymentElement) {
                    try {
                        paymentElement.unmount();
                    } catch (e) {
                        console.log('Payment element cleanup:', e.message);
                    }
                    paymentElement = null;
                }
                if (elements) {
                    elements = null;
                }
                paymentElementReady = false;
                document.getElementById('paymentModal').classList.add('hidden');
            });
            console.log('✅ Close payment button listener added');
        }
        const taskInfoForm = document.getElementById('taskInfoForm');
        if (taskInfoForm) {
            taskInfoForm.addEventListener('submit', submitTaskInfo);
            console.log('✅ Task info form listener added');
        } else {
            console.error('❌ Task info form not found');
        }
        const closeFinalSuccessBtn = document.getElementById('closeFinalSuccess');
        if (closeFinalSuccessBtn) {
            closeFinalSuccessBtn.addEventListener('click', () => {
                document.getElementById('finalSuccessModal').classList.add('hidden');
                location.reload();
            });
            console.log('✅ Close final success button listener added');
        }
        document.getElementById('year').textContent = new Date().getFullYear();
        document.getElementById('version').textContent = APP_VERSION;
        console.log('🎯 All event listeners initialized successfully');
        initializeChatbot();
    });
    console.log('📜 JavaScript finished loading');
</script>
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PW9HC7HL"
                  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
</body>
</html>